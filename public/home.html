<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="mobile-web-app-capable" content="yes" />
    <title>Global Meeting</title>
    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500;700&family=Roboto:wght@400;500&display=swap"
      rel="stylesheet"
    />
    <!-- Material Icons -->
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet"
    />

    <style>
      :root {
        --bg-color: #202124;
        --secondary-bg: #3c4043;
        --text-color: #e8eaed;
        --control-bar-bg: #202124;
        --red-color: #ea4335;
        --blue-color: #8ab4f8;
        --icon-color: #e8eaed;
      }

      * {
        box-sizing: border-box;
        -webkit-tap-highlight-color: transparent;
      }

      html, body {
        margin: 0;
        padding: 0;
        height: 100%;
        width: 100%;
        overflow: hidden;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
      }

      body {
        font-family: "Google Sans", "Roboto", sans-serif;
        background-color: var(--bg-color);
        color: var(--text-color);
        display: flex;
        flex-direction: column;
        touch-action: manipulation;
        -webkit-overflow-scrolling: touch;
      }

      /* Login / Waiting Screens */
      #login-section,
      #waiting-section {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 20px;
        text-align: center;
        background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
        position: relative;
        overflow: hidden;
      }

      /* Animated background orbs */
      #login-section::before,
      #login-section::after {
        content: '';
        position: absolute;
        border-radius: 50%;
        filter: blur(80px);
        opacity: 0.4;
        animation: float 6s ease-in-out infinite;
      }

      #login-section::before {
        width: 300px;
        height: 300px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        top: -100px;
        right: -100px;
      }

      #login-section::after {
        width: 250px;
        height: 250px;
        background: linear-gradient(135deg, #474448 0%, #f5576c 100%);
        bottom: -80px;
        left: -80px;
        animation-delay: -3s;
      }

      @keyframes float {
        0%, 100% { transform: translateY(0) rotate(0deg); }
        50% { transform: translateY(-20px) rotate(5deg); }
      }

      /* Login Card */
      .login-card {
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        padding: 40px 36px;
        width: 100%;
        max-width: 380px;
        position: relative;
        z-index: 1;
      }

      .login-logo {
        width: 64px;
        height: 64px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 16px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 20px;
        box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
      }

      .login-logo .material-icons {
        font-size: 32px;
        color: white;
      }

      .login-title {
        font-size: 1.75rem;
        font-weight: 600;
        color: #fff;
        margin-bottom: 8px;
        letter-spacing: -0.5px;
      }

      .login-subtitle {
        font-size: 0.9rem;
        color: #9aa0a6;
        margin-bottom: 32px;
      }

      .form-group {
        margin-bottom: 16px;
        text-align: left;
      }

      .form-group label {
        display: block;
        font-size: 0.8rem;
        color: #9aa0a6;
        margin-bottom: 6px;
        font-weight: 500;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .login-card input,
      .login-card select {
        width: 100%;
        padding: 14px 16px;
        margin: 0;
        border-radius: 12px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        background: rgba(255, 255, 255, 0.05);
        color: white;
        font-size: 16px;
        outline: none;
        transition: all 0.3s ease;
      }

      .login-card input::placeholder {
        color: #5f6368;
      }

      .login-card input:focus,
      .login-card select:focus {
        border-color: #667eea;
        background: rgba(102, 126, 234, 0.1);
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
      }

      .login-card select {
        cursor: pointer;
        appearance: none;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%239aa0a6' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 16px center;
        padding-right: 40px;
      }

      .login-card select option {
        background: #202124;
        color: white;
        padding: 12px;
      }

      button#join-btn {
        width: 100%;
        margin-top: 24px;
        padding: 16px 24px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        font-weight: 600;
        font-size: 1rem;
        border: none;
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      button#join-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 15px 40px rgba(102, 126, 234, 0.4);
      }

      button#join-btn:active {
        transform: translateY(0);
      }

      /* Auth Tabs */
      .auth-tab.active {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
        color: white !important;
      }

      .auth-tab:hover:not(.active) {
        background: rgba(255, 255, 255, 0.1);
        color: #e8eaed;
      }

      /* Auth Buttons (Login, Register) */
      button#login-btn,
      button#register-btn {
        width: 100%;
        margin-top: 16px;
        padding: 16px 24px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        font-weight: 600;
        font-size: 1rem;
        border: none;
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      button#login-btn:hover,
      button#register-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 15px 40px rgba(102, 126, 234, 0.4);
      }

      button#login-btn:disabled,
      button#register-btn:disabled {
        opacity: 0.7;
        cursor: not-allowed;
        transform: none;
      }

      /* Auth Message */
      .auth-message-error {
        background: rgba(234, 67, 53, 0.15) !important;
        border: 1px solid rgba(234, 67, 53, 0.3);
        color: #f28b82 !important;
      }

      .auth-message-success {
        background: rgba(52, 168, 83, 0.15) !important;
        border: 1px solid rgba(52, 168, 83, 0.3);
        color: #81c995 !important;
      }

      /* Meeting Item */
      .meeting-item {
        padding: 12px;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 8px;
        margin-bottom: 8px;
        cursor: pointer;
        transition: all 0.2s;
      }

      .meeting-item:hover {
        background: rgba(255, 255, 255, 0.1);
      }

      .meeting-item-name {
        font-weight: 500;
        color: #fff;
        font-size: 14px;
        margin-bottom: 4px;
      }

      .meeting-item-time {
        font-size: 12px;
        color: #9aa0a6;
      }

      /* Waiting Section */
      #waiting-section .login-card {
        text-align: center;
      }

      .waiting-spinner {
        width: 48px;
        height: 48px;
        border: 3px solid rgba(255, 255, 255, 0.1);
        border-top-color: #667eea;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto 20px;
      }

      @keyframes spin {
        to { transform: rotate(360deg); }
      }

      h1,
      h2 {
        font-weight: 400;
        margin-bottom: 20px;
      }

      /* Room Layout */
      #room-section {
        flex: 1;
        display: flex;
        flex-direction: column;
        height: 100%;
        background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
        position: relative;
      }

      /* Subtle animated gradient overlay */
      #room-section::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: radial-gradient(ellipse at top right, rgba(102, 126, 234, 0.15) 0%, transparent 50%),
                    radial-gradient(ellipse at bottom left, rgba(118, 75, 162, 0.1) 0%, transparent 50%);
        pointer-events: none;
        z-index: 0;
      }

      #main-area {
        flex: 1;
        display: flex;
        position: relative;
        overflow: hidden;
        z-index: 1;
      }

      #video-grid {
        flex: 1;
        display: flex;
        flex-wrap: wrap;
        align-content: center;
        justify-content: center;
        padding: 20px;
        gap: 16px;
        overflow-y: auto;
      }

      /* Use a grid logic if needed, but flex wrap is simple for now */
      video {
        background: #000;
        border-radius: 8px;
        max-width: 100%;
        max-height: 80vh;
        object-fit: contain;
      }

      /* Sidebar (Participants) - Glassmorphism */
      #sidebar {
        width: 320px;
        background: rgba(255, 255, 255, 0.08);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        color: #e8eaed;
        border-left: 1px solid rgba(255, 255, 255, 0.1);
        display: none;
        flex-direction: column;
        position: absolute;
        right: 0;
        top: 0;
        bottom: 0;
        z-index: 10;
        box-shadow: -5px 0 30px rgba(0, 0, 0, 0.3);
      }

      #sidebar.open {
        display: flex;
      }

      .sidebar-header {
        padding: 16px 20px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        background: rgba(255, 255, 255, 0.05);
      }

      .sidebar-header h3 {
        color: #fff;
        margin: 0;
        font-size: 1rem;
        font-weight: 500;
      }

      /* Sidebar Tabs */
      .sidebar-tabs {
        display: flex;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        background: rgba(0, 0, 0, 0.2);
      }

      .sidebar-tab {
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
        padding: 12px;
        background: none;
        border: none;
        color: #9aa0a6;
        font-size: 13px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
        position: relative;
      }

      .sidebar-tab .material-icons {
        font-size: 18px;
      }

      .sidebar-tab:hover {
        background: rgba(255, 255, 255, 0.05);
        color: #fff;
      }

      .sidebar-tab.active {
        color: #8ab4f8;
        border-bottom: 2px solid #8ab4f8;
      }

      .sidebar-tab-content {
        flex: 1;
        display: flex;
        flex-direction: column;
        overflow: hidden;
      }

      .unread-badge {
        background: #ea4335;
        color: white;
        font-size: 10px;
        font-weight: 600;
        padding: 2px 6px;
        border-radius: 10px;
        min-width: 16px;
        text-align: center;
      }

      .unread-dot {
        position: absolute;
        top: 6px;
        right: 6px;
        width: 10px;
        height: 10px;
        background: #ea4335;
        border-radius: 50%;
        border: 2px solid #1e1e1e;
        animation: unread-pulse 1.5s ease-in-out infinite;
      }

      @keyframes unread-pulse {
        0%, 100% { transform: scale(1); opacity: 1; }
        50% { transform: scale(1.2); opacity: 0.8; }
      }

      #participants-container {
        padding: 10px;
        overflow-y: auto;
        flex: 1;
      }

      /* Chat Styles */
      #chat-messages {
        flex: 1;
        overflow-y: auto;
        padding: 12px;
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .chat-message {
        max-width: 85%;
        padding: 10px 14px;
        border-radius: 12px;
        font-size: 13px;
        line-height: 1.4;
        animation: messageSlide 0.2s ease-out;
      }

      @keyframes messageSlide {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
      }

      .chat-message.received {
        background: rgba(255, 255, 255, 0.1);
        color: #fff;
        align-self: flex-start;
        border-bottom-left-radius: 4px;
      }

      .chat-message.sent {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: #fff;
        align-self: flex-end;
        border-bottom-right-radius: 4px;
      }

      .chat-message .sender-name {
        font-size: 11px;
        font-weight: 600;
        color: #8ab4f8;
        margin-bottom: 4px;
      }

      .chat-message.sent .sender-name {
        color: rgba(255, 255, 255, 0.7);
      }

      .chat-message .message-time {
        font-size: 10px;
        color: rgba(255, 255, 255, 0.5);
        margin-top: 4px;
        text-align: right;
      }

      #chat-input-container {
        display: flex;
        gap: 8px;
        padding: 12px;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        background: rgba(0, 0, 0, 0.2);
      }

      #chat-input {
        flex: 1;
        padding: 10px 14px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 24px;
        background: rgba(255, 255, 255, 0.05);
        color: #fff;
        font-size: 13px;
        outline: none;
        transition: all 0.2s;
      }

      #chat-input:focus {
        border-color: #8ab4f8;
        background: rgba(255, 255, 255, 0.08);
      }

      #chat-input::placeholder {
        color: #5f6368;
      }

      #chat-send-btn {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        border: none;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.2s;
      }

      #chat-send-btn:hover {
        transform: scale(1.05);
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
      }

      #chat-send-btn .material-icons {
        font-size: 18px;
      }

      .chat-empty {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        color: #5f6368;
        text-align: center;
        padding: 20px;
      }

      .chat-empty .material-icons {
        font-size: 48px;
        margin-bottom: 12px;
        opacity: 0.5;
      }

      .peer-item {
        padding: 12px 16px;
        display: flex;
        align-items: center;
        gap: 12px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        transition: background 0.2s;
      }
      
      .peer-item:hover {
        background: rgba(255, 255, 255, 0.08);
      }
      
      .peer-item.left {
        opacity: 0.5;
        order: 100;
      }
      
      .peer-avatar {
        width: 36px;
        height: 36px;
        border-radius: 50%;
        background: var(--blue-color);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 500;
        font-size: 16px;
        text-transform: uppercase;
        flex-shrink: 0;
      }
      
      .peer-info {
          display: flex;
          flex-direction: column;
          flex: 1;
          min-width: 0;
      }
      
      .peer-name {
        font-weight: 500;
        color: #fff;
        font-size: 14px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      
      .peer-time {
        font-size: 11px;
        color: #9aa0a6;
        margin-top: 2px;
      }
      
      .peer-time {
          font-size: 11px;
          color: #5f6368;
          margin-top: 2px;
      }
      
      .peer-badge {
          font-size: 10px;
          background: #e8eaed;
          color: #3c4043;
          padding: 2px 6px;
          border-radius: 4px;
          margin-left: 6px;
          font-weight: bold;
      }
      
      .peer-badge.admin {
          background: #fce8e6;
          color: #c5221f;
      }

      /* Controls Footer - Glassmorphism */
      #controls-footer {
        height: 80px;
        background: rgba(32, 33, 36, 0.7);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 16px;
        padding: 0 20px;
        z-index: 20;
        position: relative;
      }

      .control-btn {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.1);
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        color: var(--icon-color);
        transition: all 0.2s ease;
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
      }

      .control-btn:hover {
        background: rgba(255, 255, 255, 0.2);
        transform: scale(1.05);
      }

      .control-btn.active {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-color: transparent;
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
      }

      .control-btn.danger {
        background: linear-gradient(135deg, #ea4335 0%, #c5221f 100%);
        color: white;
        border-color: transparent;
        box-shadow: 0 4px 15px rgba(234, 67, 53, 0.4);
      }

      .control-btn.off {
        background: rgba(234, 67, 53, 0.3);
        color: white;
        border-color: rgba(234, 67, 53, 0.5);
      }

      .control-btn.recording {
        background: linear-gradient(135deg, #ea4335 0%, #c5221f 100%);
        color: white;
        border-color: transparent;
        box-shadow: 0 0 20px rgba(234, 67, 53, 0.6);
        animation: recording-pulse 1.5s ease-in-out infinite;
      }

      @keyframes recording-pulse {
        0%, 100% { box-shadow: 0 0 20px rgba(234, 67, 53, 0.6); }
        50% { box-shadow: 0 0 30px rgba(234, 67, 53, 0.9); }
      }

      /* Recording Indicator */
      #recording-indicator {
        position: fixed;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(234, 67, 53, 0.9);
        color: white;
        padding: 8px 16px;
        border-radius: 20px;
        font-size: 13px;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 8px;
        z-index: 1000;
        backdrop-filter: blur(10px);
        box-shadow: 0 4px 20px rgba(234, 67, 53, 0.4);
      }

      #recording-indicator .recording-dot {
        width: 10px;
        height: 10px;
        background: white;
        border-radius: 50%;
        animation: recording-dot-pulse 1s ease-in-out infinite;
      }

      @keyframes recording-dot-pulse {
        0%, 100% { opacity: 1; transform: scale(1); }
        50% { opacity: 0.5; transform: scale(0.8); }
      }

      /* Download Recording Modal */
      #download-recording-modal {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.8);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 2000;
        backdrop-filter: blur(5px);
      }

      .download-modal-content {
        background: linear-gradient(180deg, #2d2d30 0%, #1e1e1e 100%);
        border-radius: 16px;
        padding: 32px;
        max-width: 400px;
        width: 90%;
        text-align: center;
        border: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
      }

      .download-modal-icon {
        width: 64px;
        height: 64px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 20px;
      }

      .download-modal-icon .material-icons {
        font-size: 32px;
        color: white;
      }

      .download-modal-content h3 {
        color: #e8eaed;
        font-size: 1.3rem;
        margin-bottom: 12px;
      }

      .download-modal-content p {
        color: #9aa0a6;
        font-size: 14px;
        margin-bottom: 24px;
      }

      .download-modal-buttons {
        display: flex;
        gap: 12px;
        justify-content: center;
      }

      .download-modal-buttons button {
        padding: 12px 24px;
        border-radius: 8px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
        border: none;
      }

      .btn-download {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
      }

      .btn-download:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
      }

      .btn-dismiss {
        background: rgba(255, 255, 255, 0.1);
        color: #9aa0a6;
      }

      .btn-dismiss:hover {
        background: rgba(255, 255, 255, 0.15);
      }

      .material-icons {
        font-size: 24px;
      }

      /* Sharing Badge - Glassmorphism */
      .sharing-indicator {
        position: absolute;
        top: 20px;
        left: 20px;
        background: rgba(102, 126, 234, 0.2);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border: 1px solid rgba(102, 126, 234, 0.3);
        padding: 10px 16px;
        border-radius: 24px;
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 13px;
        color: #8ab4f8;
        font-weight: 500;
      }

      /* Captions */
      #subtitles-area {
        position: absolute;
        bottom: 100px;
        left: 0;
        right: 0;
        text-align: center;
        pointer-events: none;
        display: none;
        z-index: 50;
      }

      #subtitles-inner {
        display: inline-block;
        background: rgba(0, 0, 0, 0.7);
        padding: 8px 16px;
        border-radius: 4px;
        font-size: 1.2rem;
        color: white;
        max-width: 80%;
      }

      /* Traffic Signal Speaking Indicator - Glassmorphism */
      #host-speaking-indicator {
        position: absolute;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        align-items: center;
        gap: 10px;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.15);
        padding: 12px 20px;
        border-radius: 30px;
        z-index: 100;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      }

      .signal-light {
        width: 14px;
        height: 14px;
        border-radius: 50%;
        background-color: #5f6368;
        transition: all 0.3s ease;
      }

      .signal-light.idle {
        background-color: #5f6368;
        box-shadow: none;
      }

      .signal-light.speaking {
        background-color: #34a853;
        box-shadow: 0 0 12px #34a853, 0 0 24px rgba(52, 168, 83, 0.5);
        animation: pulse-green 1s infinite;
      }

      .signal-light.translating {
        background-color: #fbbc04;
        box-shadow: 0 0 12px #fbbc04, 0 0 24px rgba(251, 188, 4, 0.5);
        animation: pulse-yellow 0.5s infinite;
      }

      .signal-light.playing {
        background-color: #8ab4f8;
        box-shadow: 0 0 12px #8ab4f8, 0 0 24px rgba(138, 180, 248, 0.5);
        animation: pulse-blue 0.8s infinite;
      }

      @keyframes pulse-green {
        0%, 100% { opacity: 1; transform: scale(1); }
        50% { opacity: 0.7; transform: scale(1.1); }
      }

      @keyframes pulse-yellow {
        0%, 100% { opacity: 1; transform: scale(1); }
        50% { opacity: 0.8; transform: scale(1.1); }
      }

      @keyframes pulse-blue {
        0%, 100% { opacity: 1; transform: scale(1); }
        50% { opacity: 0.8; transform: scale(1.15); }
      }

      .signal-label {
        color: #fff;
        font-size: 13px;
        font-weight: 500;
        letter-spacing: 0.3px;
      }

      /* Enhanced indicator when active */
      #host-speaking-indicator.active {
        background: linear-gradient(135deg, rgba(52, 168, 83, 0.15) 0%, rgba(102, 126, 234, 0.15) 100%);
        border-color: rgba(52, 168, 83, 0.3);
      }

      /* Host Feedback Panel - Shows translation activity (host only) */
      #host-feedback-panel {
        position: absolute;
        top: 80px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.15);
        border-radius: 16px;
        padding: 12px 16px;
        min-width: 200px;
        max-width: 300px;
        z-index: 99;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        opacity: 0;
        transition: opacity 0.3s ease, transform 0.3s ease;
        display: none;
      }

      #host-feedback-panel.visible {
        display: block;
        opacity: 1;
      }

      #host-feedback-panel.hidden {
        opacity: 0;
        display: none;
      }

      .feedback-header {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 10px;
        padding-bottom: 8px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        color: #8ab4f8;
        font-size: 12px;
        font-weight: 500;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .feedback-header .material-icons {
        font-size: 16px;
      }

      .translation-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 6px 0;
        font-size: 13px;
      }

      .client-name {
        color: #e8eaed;
        font-weight: 500;
      }

      .client-status {
        font-size: 11px;
        padding: 3px 8px;
        border-radius: 12px;
        background: rgba(251, 188, 4, 0.2);
        color: #fbbc04;
      }

      .client-status.playing {
        background: rgba(138, 180, 248, 0.2);
        color: #8ab4f8;
      }

      /* Client Audio Playing Indicator */
      #client-audio-indicator {
        position: absolute;
        bottom: 100px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(138, 180, 248, 0.15);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border: 1px solid rgba(138, 180, 248, 0.3);
        padding: 10px 20px;
        border-radius: 30px;
        display: none;
        align-items: center;
        gap: 12px;
        z-index: 60;
        color: #8ab4f8;
        font-size: 13px;
        font-weight: 500;
      }

      #client-audio-indicator.visible {
        display: flex;
        animation: fadeIn 0.3s ease;
      }

      #client-audio-indicator.hidden {
        display: none;
      }

      .audio-wave {
        display: flex;
        align-items: center;
        gap: 3px;
        height: 20px;
      }

      .audio-wave::before,
      .audio-wave::after,
      .audio-wave span {
        content: '';
        width: 3px;
        height: 100%;
        background: #8ab4f8;
        border-radius: 3px;
        animation: wave 0.5s ease-in-out infinite;
      }

      .audio-wave::before {
        animation-delay: 0s;
        height: 60%;
      }

      .audio-wave span {
        animation-delay: 0.1s;
        height: 100%;
      }

      .audio-wave::after {
        animation-delay: 0.2s;
        height: 40%;
      }

      @keyframes wave {
        0%, 100% { transform: scaleY(0.5); }
        50% { transform: scaleY(1); }
      }

      @keyframes fadeIn {
        from { opacity: 0; transform: translateX(-50%) translateY(10px); }
        to { opacity: 1; transform: translateX(-50%) translateY(0); }
      }

      /* Audio Mode Button Active State */
      #audio-mode-btn.active {
        background: linear-gradient(135deg, #fbbc04 0%, #f9ab00 100%) !important;
        color: #202124 !important;
        box-shadow: 0 4px 20px rgba(251, 188, 4, 0.5);
      }

      /* Scrollable Transcript Container - Glassmorphism */
      #transcript-container {
        position: absolute;
        bottom: 90px;
        left: 50%;
        transform: translateX(-50%);
        width: 80%;
        max-width: 700px;
        max-height: 220px;
        background: rgba(255, 255, 255, 0.08);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 16px;
        overflow: hidden;
        z-index: 50;
        display: none;
        flex-direction: column;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      }

      #transcript-container.visible {
        display: flex;
      }

      #transcript-header {
        padding: 12px 20px;
        background: rgba(255, 255, 255, 0.05);
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      #transcript-header span {
        font-size: 13px;
        color: #fff;
        font-weight: 500;
      }

      #transcript-entries {
        flex: 1;
        overflow-y: auto;
        padding: 12px 16px;
        scroll-behavior: smooth;
      }

      .transcript-entry {
        margin-bottom: 12px;
        padding-bottom: 8px;
        border-bottom: 1px solid rgba(95, 99, 104, 0.3);
      }

      .transcript-entry:last-child {
        border-bottom: none;
        margin-bottom: 0;
      }

      .transcript-meta {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 4px;
      }

      .transcript-name {
        font-weight: 500;
        color: #8ab4f8;
        font-size: 13px;
      }

      .transcript-name.host {
        color: #f28b82;
      }

      .transcript-time {
        font-size: 11px;
        color: #9aa0a6;
      }

      .transcript-badge {
        font-size: 10px;
        padding: 2px 6px;
        border-radius: 4px;
        background: rgba(138, 180, 248, 0.2);
        color: #8ab4f8;
      }

      .transcript-badge.translated {
        background: rgba(251, 188, 4, 0.2);
        color: #fbbc04;
      }

      .transcript-text {
        color: #e8eaed;
        font-size: 14px;
        line-height: 1.4;
      }

      .hidden {
        display: none !important;
      }

      /* Mobile Responsiveness */
      @media (max-width: 768px) {
        /* Ensure full height on mobile */
        html, body {
          height: 100%;
          height: -webkit-fill-available;
        }

        /* Room Section Layout */
        #room-section {
          display: flex;
          flex-direction: column;
          height: 100%;
          position: relative;
        }

        /* Mobile Header for Room Info */
        #mobile-header {
          display: flex;
          align-items: center;
          justify-content: center;
          gap: 8px;
          padding: 10px 12px;
          background-color: var(--control-bar-bg);
          border-bottom: 1px solid #3c4043;
          color: #e8eaed;
          font-size: 12px;
          flex-shrink: 0;
          min-height: 44px;
        }

        #mobile-header .room-info-mobile {
          display: flex;
          align-items: center;
          gap: 6px;
          flex-wrap: wrap;
          justify-content: center;
        }

        /* Hide desktop room info in footer on mobile */
        #controls-footer .room-info-desktop {
          display: none !important;
        }

        /* Controls Footer - Mobile */
        #controls-footer {
          height: 60px;
          min-height: 60px;
          padding: 8px 8px;
          padding-bottom: max(8px, env(safe-area-inset-bottom));
          gap: 8px;
          justify-content: center;
          flex-shrink: 0;
          flex-wrap: nowrap;
          overflow-x: auto;
          -webkit-overflow-scrolling: touch;
        }

        /* Smaller control buttons on mobile */
        .control-btn {
          width: 42px;
          height: 42px;
          min-width: 42px;
          min-height: 42px;
          flex-shrink: 0;
        }

        .control-btn.danger {
          width: 50px !important;
          min-width: 50px !important;
        }

        .material-icons {
          font-size: 20px;
        }

        /* Main area adjustments */
        #main-area {
          flex: 1;
          min-height: 0;
          overflow: hidden;
          position: relative;
        }

        #video-grid {
          padding: 8px;
          gap: 8px;
          height: 100%;
          overflow-y: auto;
        }

        /* Full-width sidebar on mobile */
        #sidebar {
          width: 100%;
          border-left: none;
          max-height: 60vh;
        }

        /* Host speaking indicator mobile */
        #host-speaking-indicator {
          top: 8px;
          padding: 6px 12px;
          gap: 6px;
          border-radius: 16px;
          max-width: 90%;
        }

        .signal-light {
          width: 12px;
          height: 12px;
        }

        .signal-label {
          font-size: 11px;
        }

        /* Transcript container mobile */
        #transcript-container {
          width: 94%;
          max-width: none;
          bottom: 70px;
          max-height: 150px;
          border-radius: 8px;
        }

        #transcript-header {
          padding: 8px 12px;
        }

        #transcript-header span {
          font-size: 12px;
        }

        #transcript-entries {
          padding: 8px 12px;
        }

        .transcript-entry {
          margin-bottom: 8px;
          padding-bottom: 6px;
        }

        .transcript-name {
          font-size: 12px;
        }

        .transcript-time {
          font-size: 10px;
        }

        .transcript-badge {
          font-size: 9px;
          padding: 2px 4px;
        }

        .transcript-text {
          font-size: 13px;
        }

        /* Subtitles closer to bottom on mobile */
        #subtitles-area {
          bottom: 70px;
        }

        #subtitles-inner {
          font-size: 0.9rem;
          padding: 6px 10px;
          max-width: 92%;
        }

        /* Login section mobile */
        #login-section {
          padding: 16px;
          justify-content: flex-start;
          padding-top: 15vh;
        }

        #login-section h1 {
          font-size: 1.5rem;
          margin-bottom: 24px;
        }

        #login-section input,
        #login-section select {
          width: 100%;
          max-width: 300px;
          padding: 14px 16px;
          font-size: 16px; /* Prevents iOS zoom on focus */
        }

        #login-section button#join-btn {
          width: 100%;
          max-width: 300px;
          padding: 14px 24px;
          font-size: 16px;
        }

        /* Join requests area mobile */
        #join-requests-area {
          left: 8px;
          right: 8px;
          top: 50px;
          bottom: auto;
        }

        #join-requests-area > div {
          min-width: auto !important;
          width: 100%;
        }

        /* Sharing indicator mobile */
        .sharing-indicator {
          top: 8px;
          left: 8px;
          font-size: 11px;
          padding: 5px 8px;
          gap: 4px;
        }

        .sharing-indicator .material-icons {
          font-size: 16px;
        }
      }

      /* Extra small devices */
      @media (max-width: 360px) {
        .control-btn {
          width: 38px;
          height: 38px;
          min-width: 38px;
          min-height: 38px;
        }

        #controls-footer {
          gap: 6px;
          padding: 6px;
        }

        .material-icons {
          font-size: 18px;
        }
      }

      /* Hide mobile header on desktop */
      #mobile-header {
        display: none;
      }

      /* ============================================
         Meeting Management Modal Styles
         ============================================ */
      #meeting-modal {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.8);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 2000;
        backdrop-filter: blur(5px);
      }

      .meeting-modal-content {
        background: rgba(32, 33, 36, 0.95);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 16px;
        width: 90%;
        max-width: 560px;
        max-height: 85vh;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        box-shadow: 0 25px 60px rgba(0, 0, 0, 0.5);
      }

      .meeting-modal-header {
        padding: 20px 24px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        display: flex;
        align-items: center;
        justify-content: space-between;
        background: rgba(255, 255, 255, 0.03);
      }

      .meeting-modal-header h2 {
        margin: 0;
        font-size: 1.25rem;
        font-weight: 500;
        color: #fff;
      }

      .meeting-modal-close {
        background: none;
        border: none;
        color: #9aa0a6;
        font-size: 24px;
        cursor: pointer;
        padding: 4px;
        line-height: 1;
        transition: color 0.2s;
      }

      .meeting-modal-close:hover {
        color: #fff;
      }

      .meeting-modal-tabs {
        display: flex;
        gap: 0;
        padding: 0 24px;
        background: rgba(255, 255, 255, 0.02);
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      }

      .meeting-modal-tab {
        padding: 14px 20px;
        border: none;
        background: transparent;
        color: #9aa0a6;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        border-bottom: 2px solid transparent;
        transition: all 0.2s;
      }

      .meeting-modal-tab:hover {
        color: #e8eaed;
      }

      .meeting-modal-tab.active {
        color: #8ab4f8;
        border-bottom-color: #8ab4f8;
      }

      .meeting-modal-body {
        flex: 1;
        overflow-y: auto;
        padding: 24px;
      }

      .meeting-modal-footer {
        padding: 16px 24px;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        display: flex;
        justify-content: space-between;
        gap: 12px;
        background: rgba(255, 255, 255, 0.02);
      }

      .modal-btn {
        padding: 10px 20px;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
        border: none;
      }

      .modal-btn-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
      }

      .modal-btn-primary:hover {
        transform: translateY(-1px);
        box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
      }

      .modal-btn-danger {
        background: rgba(234, 67, 53, 0.15);
        color: #f28b82;
        border: 1px solid rgba(234, 67, 53, 0.3);
      }

      .modal-btn-danger:hover {
        background: rgba(234, 67, 53, 0.25);
      }

      .modal-btn-secondary {
        background: rgba(255, 255, 255, 0.1);
        color: #e8eaed;
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .modal-btn-secondary:hover {
        background: rgba(255, 255, 255, 0.15);
      }

      /* Participant List */
      .participant-list {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .participant-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 12px 14px;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 10px;
        transition: background 0.2s;
      }

      .participant-item:hover {
        background: rgba(255, 255, 255, 0.08);
      }

      .participant-avatar {
        width: 38px;
        height: 38px;
        border-radius: 50%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 600;
        font-size: 14px;
        flex-shrink: 0;
        overflow: hidden;
      }

      .participant-avatar img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      .participant-info {
        flex: 1;
        min-width: 0;
      }

      .participant-name {
        font-weight: 500;
        color: #fff;
        font-size: 14px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .participant-username {
        font-size: 12px;
        color: #9aa0a6;
        margin-top: 2px;
      }

      /* Status Badges */
      .status-badge {
        font-size: 11px;
        padding: 4px 10px;
        border-radius: 20px;
        font-weight: 500;
        white-space: nowrap;
      }

      .status-pending {
        background: rgba(251, 188, 4, 0.15);
        color: #fbbc04;
      }

      .status-accepted {
        background: rgba(52, 168, 83, 0.15);
        color: #81c995;
      }

      .status-declined {
        background: rgba(234, 67, 53, 0.15);
        color: #f28b82;
      }

      .status-owner {
        background: rgba(138, 180, 248, 0.15);
        color: #8ab4f8;
      }

      .participant-remove {
        background: none;
        border: none;
        color: #9aa0a6;
        cursor: pointer;
        padding: 6px;
        border-radius: 50%;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .participant-remove:hover {
        background: rgba(234, 67, 53, 0.2);
        color: #f28b82;
      }

      /* User Search */
      .user-search-container {
        position: relative;
        margin-bottom: 16px;
      }

      .user-search-input {
        width: 100%;
        padding: 12px 16px;
        padding-right: 44px;
        border-radius: 10px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        background: rgba(255, 255, 255, 0.05);
        color: white;
        font-size: 14px;
        outline: none;
        transition: all 0.2s;
      }

      .user-search-input:focus {
        border-color: #667eea;
        background: rgba(102, 126, 234, 0.1);
      }

      .user-search-input::placeholder {
        color: #5f6368;
      }

      .user-search-icon {
        position: absolute;
        right: 14px;
        top: 50%;
        transform: translateY(-50%);
        color: #9aa0a6;
        pointer-events: none;
      }

      .user-search-dropdown {
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        margin-top: 4px;
        background: rgba(32, 33, 36, 0.98);
        border: 1px solid rgba(255, 255, 255, 0.15);
        border-radius: 10px;
        max-height: 200px;
        overflow-y: auto;
        z-index: 100;
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.4);
      }

      .user-search-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 12px 14px;
        cursor: pointer;
        transition: background 0.2s;
      }

      .user-search-item:hover {
        background: rgba(255, 255, 255, 0.08);
      }

      .user-search-empty {
        padding: 16px;
        text-align: center;
        color: #9aa0a6;
        font-size: 13px;
      }

      /* Meeting Info Display */
      .meeting-info-row {
        display: flex;
        align-items: flex-start;
        gap: 12px;
        margin-bottom: 16px;
      }

      .meeting-info-label {
        font-size: 12px;
        color: #9aa0a6;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        min-width: 90px;
        padding-top: 10px;
      }

      .meeting-info-value {
        flex: 1;
      }

      .meeting-info-value input,
      .meeting-info-value textarea {
        width: 100%;
        padding: 10px 14px;
        border-radius: 8px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        background: rgba(255, 255, 255, 0.05);
        color: white;
        font-size: 14px;
        outline: none;
        transition: all 0.2s;
        font-family: inherit;
      }

      .meeting-info-value textarea {
        min-height: 80px;
        resize: vertical;
      }

      .meeting-info-value input:focus,
      .meeting-info-value textarea:focus {
        border-color: #667eea;
        background: rgba(102, 126, 234, 0.1);
      }

      .meeting-info-value input:disabled,
      .meeting-info-value textarea:disabled {
        opacity: 0.6;
        cursor: not-allowed;
      }

      /* Acceptance Buttons in Meeting List */
      .meeting-item-actions {
        display: flex;
        gap: 6px;
        margin-top: 8px;
      }

      .accept-btn, .decline-btn {
        padding: 5px 12px;
        font-size: 11px;
        border-radius: 6px;
        font-weight: 500;
        cursor: pointer;
        border: none;
        transition: all 0.2s;
      }

      .accept-btn {
        background: rgba(52, 168, 83, 0.2);
        color: #81c995;
      }

      .accept-btn:hover {
        background: rgba(52, 168, 83, 0.35);
      }

      .decline-btn {
        background: rgba(234, 67, 53, 0.2);
        color: #f28b82;
      }

      .decline-btn:hover {
        background: rgba(234, 67, 53, 0.35);
      }

      /* Meeting Owner Badge */
      .meeting-owner-badge {
        font-size: 10px;
        padding: 2px 6px;
        border-radius: 4px;
        background: rgba(138, 180, 248, 0.2);
        color: #8ab4f8;
        margin-left: 6px;
      }

      /* Delete Confirmation Dialog */
      .confirm-dialog {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.85);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 3000;
      }

      .confirm-dialog-content {
        background: rgba(32, 33, 36, 0.98);
        border: 1px solid rgba(255, 255, 255, 0.15);
        border-radius: 12px;
        padding: 24px;
        max-width: 380px;
        text-align: center;
      }

      .confirm-dialog-icon {
        width: 48px;
        height: 48px;
        border-radius: 50%;
        background: rgba(234, 67, 53, 0.15);
        color: #f28b82;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 16px;
      }

      .confirm-dialog h3 {
        color: #fff;
        font-size: 18px;
        margin: 0 0 8px;
      }

      .confirm-dialog p {
        color: #9aa0a6;
        font-size: 14px;
        margin: 0 0 20px;
      }

      .confirm-dialog-buttons {
        display: flex;
        gap: 12px;
        justify-content: center;
      }

      /* ============================================
         Video Tiles Styles
         ============================================ */
      .video-tile {
        position: relative;
        background: rgba(30, 30, 35, 0.95);
        border-radius: 12px;
        overflow: hidden;
        aspect-ratio: 16/9;
        min-width: 280px;
        max-width: 100%;
        flex: 1 1 300px;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .video-tile.local {
        border-color: #8ab4f8;
        box-shadow: 0 0 0 2px rgba(138, 180, 248, 0.3);
      }

      .video-tile video {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      .video-tile .video-label {
        position: absolute;
        bottom: 10px;
        left: 10px;
        background: rgba(0, 0, 0, 0.7);
        backdrop-filter: blur(4px);
        padding: 6px 12px;
        border-radius: 6px;
        font-size: 12px;
        font-weight: 500;
        color: #fff;
        display: flex;
        align-items: center;
        gap: 6px;
      }

      .video-tile .video-label .material-icons {
        font-size: 14px;
      }

      .video-tile .no-video-placeholder {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 8px;
        color: #5f6368;
      }

      .video-tile .no-video-placeholder .avatar-circle {
        width: 64px;
        height: 64px;
        border-radius: 50%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        font-weight: 600;
        color: white;
      }

      .video-tile .no-video-placeholder .name {
        font-size: 14px;
        color: #9aa0a6;
      }

      /* Local video preview smaller style */
      .video-tile.local-preview {
        position: absolute;
        bottom: 100px;
        right: 20px;
        width: 200px;
        min-width: 160px;
        z-index: 30;
        aspect-ratio: 4/3;
        border-radius: 8px;
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.4);
      }

      @media (max-width: 768px) {
        .video-tile.local-preview {
          width: 120px;
          min-width: 100px;
          bottom: 70px;
          right: 10px;
        }

        .video-tile {
          min-width: 100%;
          border-radius: 8px;
        }
      }
    </style>
  </head>
  <body>
    <!-- Login Section -->
    <div id="login-section">
      <!-- Container for side-by-side layout (centers when only one card visible) -->
      <div id="auth-container" style="display: flex; gap: 24px; align-items: flex-start; width: 100%; max-width: 800px; justify-content: center;">
        
        <!-- Left: Auth Card -->
        <div class="login-card" style="flex: 1; max-width: 420px;">
          
          <!-- User Info Header (shown when authenticated) -->
          <div id="user-info-header" class="hidden" style="margin-bottom: 20px; padding-bottom: 16px; border-bottom: 1px solid rgba(255,255,255,0.1);">
            <div style="display: flex; align-items: center; gap: 12px;">
              <div id="user-avatar" style="width: 44px; height: 44px; border-radius: 50%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 18px; color: white;"></div>
              <div style="flex: 1;">
                <div id="user-fullname" style="font-weight: 500; color: #fff;"></div>
                <div id="user-username" style="font-size: 12px; color: #9aa0a6;"></div>
              </div>
              <button id="dashboard-btn" onclick="openAccountModal()" style="padding: 6px 12px; border: none; background: rgba(138, 180, 248, 0.2); color: #8ab4f8; border-radius: 6px; cursor: pointer; font-size: 13px; font-weight: 500; margin-right: 8px; display: flex; align-items: center; gap: 6px;">
                <span class="material-icons" style="font-size: 16px;">dashboard</span>
                Dashboard
              </button>
              <button id="settings-btn" onclick="toggleSettingsModal()" style="padding: 6px 8px; border: none; background: rgba(255,255,255,0.1); color: #9aa0a6; border-radius: 6px; cursor: pointer; font-size: 14px; margin-right: 4px;" title="Settings">
                <span class="material-icons" style="font-size: 18px; vertical-align: middle;">settings</span>
              </button>
              <button id="logout-btn" style="padding: 6px 12px; border: none; background: rgba(234, 67, 53, 0.2); color: #f28b82; border-radius: 6px; cursor: pointer; font-size: 12px; font-weight: 500;">Logout</button>
            </div>
          </div>
        
          <h1 class="login-title">Global Meeting</h1>
          <p class="login-subtitle">Real-time translation for everyone</p>
          
          <!-- Tab Navigation -->
          <div class="auth-tabs" style="display: flex; gap: 0; margin-bottom: 24px; background: rgba(255,255,255,0.05); border-radius: 10px; padding: 4px;">
            <button class="auth-tab" data-tab="join" id="join-tab-btn" style="flex: 1; padding: 10px 16px; border: none; background: transparent; color: #9aa0a6; cursor: pointer; border-radius: 8px; font-weight: 500; font-size: 14px; transition: all 0.2s; display: none;">Join</button>
            <button class="auth-tab active" data-tab="login" style="flex: 1; padding: 10px 16px; border: none; background: transparent; color: #9aa0a6; cursor: pointer; border-radius: 8px; font-weight: 500; font-size: 14px; transition: all 0.2s;">Login</button>
            <button class="auth-tab" data-tab="register" style="flex: 1; padding: 10px 16px; border: none; background: transparent; color: #9aa0a6; cursor: pointer; border-radius: 8px; font-weight: 500; font-size: 14px; transition: all 0.2s;">Register</button>
          </div>
          
          <!-- Error/Success Messages -->
          <div id="auth-message" class="hidden" style="padding: 12px 16px; border-radius: 8px; margin-bottom: 16px; font-size: 14px;"></div>
          
          <!-- Join Tab (requires authentication) -->
          <div id="tab-join" class="tab-content hidden">
            <div class="form-group">
              <label>Room ID</label>
              <input type="text" id="room-id" placeholder="Enter room code" value="room1" />
            </div>
            
            <div class="form-group">
              <label>Your Name</label>
              <input type="text" id="username" placeholder="Your display name" readonly />
            </div>
            
            <div class="form-group">
              <label>Your Language</label>
              <select id="language">
                <option value="en-US"> English</option>
                <option value="es-ES"> Spanish</option>
                <option value="fr-FR"> French</option>
                <option value="hi-IN"> Hindi</option>
                <option value="ru-RU"> Russian</option>
                <option value="zh-CN"> Chinese</option>
              </select>
            </div>
            
            <button id="join-btn">Join Meeting</button>
          </div>
          
          <!-- Login Tab (default for unauthenticated users) -->
          <div id="tab-login" class="tab-content">
            <div class="form-group">
              <label>Username or Email</label>
              <input type="text" id="login-username" placeholder="Enter username or email" />
            </div>
            
            <div class="form-group">
              <label>Password</label>
              <input type="password" id="login-password" placeholder="Enter password" />
            </div>
            
            <button id="login-btn">Sign In</button>
            
            <p style="text-align: center; margin-top: 16px; font-size: 13px; color: #9aa0a6;">
              Don't have an account? <a href="#" onclick="switchTab('register'); return false;" style="color: #8ab4f8; text-decoration: none;">Register</a>
            </p>
          </div>
          
          <!-- Register Tab -->
          <div id="tab-register" class="tab-content hidden">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
              <div class="form-group" style="margin-bottom: 12px;">
                <label>First Name</label>
                <input type="text" id="reg-firstname" placeholder="First name" />
              </div>
              <div class="form-group" style="margin-bottom: 12px;">
                <label>Last Name</label>
                <input type="text" id="reg-lastname" placeholder="Last name" />
              </div>
            </div>
            
            <div class="form-group">
              <label>Username</label>
              <input type="text" id="reg-username" placeholder="Choose a username" />
            </div>
            
            <div class="form-group">
              <label>Email</label>
              <input type="email" id="reg-email" placeholder="Enter your email" />
            </div>
            
            <div class="form-group">
              <label>Password</label>
              <input type="password" id="reg-password" placeholder="Create a password" />
            </div>
            
            <div class="form-group">
              <label>Confirm Password</label>
              <input type="password" id="reg-confirm-password" placeholder="Confirm password" />
            </div>
            
            <button id="register-btn">Create Account</button>
            
            <p style="text-align: center; margin-top: 16px; font-size: 13px; color: #9aa0a6;">
              Already have an account? <a href="#" onclick="switchTab('login'); return false;" style="color: #8ab4f8; text-decoration: none;">Sign In</a>
            </p>
          </div>
        </div>

        <!-- My Account / Dashboard Modal -->
        <div id="account-modal" class="hidden" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); display: flex; align-items: center; justify-content: center; z-index: 1000;">
          <div class="login-card" style="max-width: 520px; position: relative; max-height: 90vh; overflow-y: auto; padding: 0;">
            <!-- Modal Header -->
            <div style="padding: 20px 24px 16px; border-bottom: 1px solid rgba(255,255,255,0.1);">
              <button onclick="closeAccountModal()" style="position: absolute; top: 12px; right: 12px; background: none; border: none; color: #9aa0a6; cursor: pointer; font-size: 20px;">&times;</button>
              <h2 style="color: #fff; margin: 0 0 4px; font-size: 1.3rem; display: flex; align-items: center; gap: 10px;">
                <span class="material-icons" style="color: #8ab4f8;">dashboard</span>
                My Dashboard
              </h2>
              <p style="color: #9aa0a6; margin: 0; font-size: 13px;">Manage your meetings and invitations</p>
            </div>
            
            <!-- Modal Tabs -->
            <div style="display: flex; gap: 0; margin: 0; background: rgba(255,255,255,0.03); padding: 0; border-bottom: 1px solid rgba(255,255,255,0.1);">
              <button onclick="switchAccountTab('meetings')" id="tab-meetings" class="dashboard-tab active" style="flex: 1; padding: 12px 16px; border: none; background: transparent; color: #9aa0a6; cursor: pointer; font-weight: 500; font-size: 13px; border-bottom: 2px solid transparent; transition: all 0.2s;"> Upcoming</button>
              <button onclick="switchAccountTab('invitations')" id="tab-invitations" class="dashboard-tab" style="flex: 1; padding: 12px 16px; border: none; background: transparent; color: #9aa0a6; cursor: pointer; font-weight: 500; font-size: 13px; border-bottom: 2px solid transparent; position: relative; transition: all 0.2s;">
                 Invitations
                <span id="invitations-badge" class="hidden" style="position: absolute; top: 8px; right: calc(50% - 40px); width: 8px; height: 8px; background: #ea4335; border-radius: 50%;"></span>
              </button>
            </div>
            
            <!-- Modal Content -->
            <div style="padding: 20px 24px; max-height: 400px; overflow-y: auto;">
              
              <!-- Upcoming Meetings Tab -->
              <div id="content-meetings">
                <!-- Header with Create Button -->
                <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px;">
                  <h3 style="margin: 0; font-size: 15px; font-weight: 600; color: #fff;">Scheduled Meetings</h3>
                  <button onclick="openCreateMeetingModal()" style="display: flex; align-items: center; gap: 6px; padding: 8px 14px; border: none; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 8px; cursor: pointer; font-size: 12px; font-weight: 500;">
                    <span class="material-icons" style="font-size: 14px;">add</span>
                    New Meeting
                  </button>
                </div>

                <div id="meetings-list" style="display: flex; flex-direction: column; gap: 8px;">
                  <!-- Loaded via JS -->
                  <div style="text-align: center; padding: 24px; color: #9aa0a6; font-size: 13px;">Loading meetings...</div>
                </div>
                
                <div id="meetings-empty-state" class="hidden" style="text-align: center; padding: 32px 16px;">
                  <div style="width: 48px; height: 48px; border-radius: 50%; background: rgba(255,255,255,0.05); display: flex; align-items: center; justify-content: center; margin: 0 auto 12px;">
                    <span class="material-icons" style="font-size: 24px; color: #5f6368;">event_busy</span>
                  </div>
                  <p style="color: #9aa0a6; font-size: 14px; margin: 0 0 8px;">No upcoming meetings</p>
                  <button onclick="openCreateMeetingModal()" style="background: none; border: none; color: #8ab4f8; cursor: pointer; font-size: 13px; font-weight: 500;">Schedule your first meeting</button>
                </div>
              </div>

              <!-- Invitations Tab -->
              <div id="content-invitations" class="hidden">
                <h3 style="margin: 0 0 16px; font-size: 15px; font-weight: 600; color: #fff;">Pending Invitations</h3>
                 
                <div id="invitations-list" style="display: flex; flex-direction: column; gap: 8px;">
                  <!-- Loaded via JS -->
                </div>
                 
                <div id="invitations-empty-state" class="hidden" style="text-align: center; padding: 32px 16px;">
                  <div style="width: 48px; height: 48px; border-radius: 50%; background: rgba(255,255,255,0.05); display: flex; align-items: center; justify-content: center; margin: 0 auto 12px;">
                    <span class="material-icons" style="font-size: 24px; color: #5f6368;">mail_outline</span>
                  </div>
                  <p style="color: #9aa0a6; font-size: 14px; margin: 0;">No pending invitations</p>
                </div>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>

    <!-- Waiting Section -->
    <div id="waiting-section" class="hidden">
      <div class="login-card">
        <div class="waiting-spinner"></div>
        <h2 style="color: #fff; margin-bottom: 8px;">Asking to join...</h2>
        <p style="color: #9aa0a6; margin: 0;">You'll join the call when the host lets you in.</p>
      </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="hidden" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); display: flex; align-items: center; justify-content: center; z-index: 1000;">
      <div class="login-card" style="max-width: 420px; position: relative; max-height: 90vh; overflow-y: auto;">
        <button onclick="toggleSettingsModal()" style="position: absolute; top: 12px; right: 12px; background: none; border: none; color: #9aa0a6; cursor: pointer; font-size: 20px;">&times;</button>
        
        <h2 style="color: #fff; margin-bottom: 8px; font-size: 1.3rem;"> Settings</h2>
        <p style="color: #9aa0a6; margin-bottom: 20px; font-size: 13px;">Manage your account</p>
        
        <!-- Settings Tabs -->
        <div style="display: flex; gap: 0; margin-bottom: 20px; background: rgba(255,255,255,0.05); border-radius: 8px; padding: 3px;">
          <button class="settings-tab active" data-settings-tab="profile" style="flex: 1; padding: 8px 10px; border: none; background: transparent; color: #9aa0a6; cursor: pointer; border-radius: 6px; font-weight: 500; font-size: 12px;">Profile</button>
          <button class="settings-tab" data-settings-tab="password" style="flex: 1; padding: 8px 10px; border: none; background: transparent; color: #9aa0a6; cursor: pointer; border-radius: 6px; font-weight: 500; font-size: 12px;">Password</button>
          <button class="settings-tab" data-settings-tab="email" style="flex: 1; padding: 8px 10px; border: none; background: transparent; color: #9aa0a6; cursor: pointer; border-radius: 6px; font-weight: 500; font-size: 12px;">Email</button>
        </div>
        
        <div id="settings-message" class="hidden" style="padding: 10px 14px; border-radius: 6px; margin-bottom: 14px; font-size: 13px;"></div>
        
        <!-- Profile Tab -->
        <div id="settings-profile" class="settings-content">
          <!-- Avatar Upload -->
          <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 20px;">
            <div id="settings-avatar-preview" style="width: 64px; height: 64px; border-radius: 50%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 24px; color: white; overflow: hidden;">
              <img id="settings-avatar-img" src="" style="width: 100%; height: 100%; object-fit: cover; display: none;" />
              <span id="settings-avatar-letter"></span>
            </div>
            <div style="flex: 1;">
              <label for="avatar-upload" style="display: inline-block; padding: 8px 16px; background: rgba(255,255,255,0.1); color: #e8eaed; border-radius: 6px; cursor: pointer; font-size: 13px; font-weight: 500;">
                 Change Avatar
              </label>
              <input type="file" id="avatar-upload" accept="image/*" style="display: none;" onchange="handleAvatarSelect(this)" />
              <p style="margin-top: 6px; font-size: 11px; color: #9aa0a6;">JPG, PNG (max 2MB)</p>
            </div>
          </div>
          
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
            <div class="form-group" style="margin-bottom: 12px;">
              <label>First Name</label>
              <input type="text" id="settings-firstname" placeholder="First name" />
            </div>
            <div class="form-group" style="margin-bottom: 12px;">
              <label>Last Name</label>
              <input type="text" id="settings-lastname" placeholder="Last name" />
            </div>
          </div>
          
          <div class="form-group">
            <label>Username</label>
            <input type="text" id="settings-username" placeholder="Username" />
            <p style="margin-top: 4px; font-size: 11px; color: #9aa0a6;"> Changing username may affect your login</p>
          </div>
          
          <button id="save-profile-btn" style="width: 100%; margin-top: 12px; padding: 12px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 500;">Save Profile</button>
        </div>
        
        <!-- Change Password Tab -->
        <div id="settings-password" class="settings-content hidden">
          <div class="form-group">
            <label>Current Password</label>
            <input type="password" id="settings-current-password" placeholder="Enter current password" />
          </div>
          <div class="form-group">
            <label>New Password</label>
            <input type="password" id="settings-new-password" placeholder="Enter new password" />
          </div>
          <div class="form-group">
            <label>Confirm New Password</label>
            <input type="password" id="settings-confirm-password" placeholder="Confirm new password" />
          </div>
          <button id="change-password-btn" style="width: 100%; margin-top: 12px; padding: 12px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 500;">Change Password</button>
        </div>
        
        <!-- Change Email Tab -->
        <div id="settings-email" class="settings-content hidden">
          <div class="form-group">
            <label>Current Password</label>
            <input type="password" id="settings-email-password" placeholder="Enter your password" />
          </div>
          <div class="form-group">
            <label>New Email</label>
            <input type="email" id="settings-new-email" placeholder="Enter new email" />
          </div>
          <button id="change-email-btn" style="width: 100%; margin-top: 12px; padding: 12px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 500;">Change Email</button>
        </div>
      </div>
    </div>

    <!-- Meeting Management Modal -->
    <div id="meeting-modal" class="hidden">
      <div class="meeting-modal-content">
        <div class="meeting-modal-header">
          <h2 id="meeting-modal-title">Manage Meeting</h2>
          <button class="meeting-modal-close" onclick="closeMeetingModal()">&times;</button>
        </div>
        
        <div class="meeting-modal-tabs">
          <button class="meeting-modal-tab active" data-modal-tab="details" onclick="switchMeetingModalTab('details')">Details</button>
          <button class="meeting-modal-tab" data-modal-tab="participants" onclick="switchMeetingModalTab('participants')">Participants</button>
        </div>
        
        <div class="meeting-modal-body">
          <!-- Details Tab -->
          <div id="meeting-tab-details" class="meeting-tab-content">
            <div class="meeting-info-row">
              <span class="meeting-info-label">Name</span>
              <div class="meeting-info-value">
                <input type="text" id="meeting-edit-name" placeholder="Meeting name" />
              </div>
            </div>
            <div class="meeting-info-row">
              <span class="meeting-info-label">Description</span>
              <div class="meeting-info-value">
                <textarea id="meeting-edit-description" placeholder="Meeting description (optional)"></textarea>
              </div>
            </div>
            <div class="meeting-info-row">
              <span class="meeting-info-label">Date & Time</span>
              <div class="meeting-info-value">
                <input type="datetime-local" id="meeting-edit-datetime" />
              </div>
            </div>
            <div class="meeting-info-row">
              <span class="meeting-info-label">Owner</span>
              <div class="meeting-info-value">
                <input type="text" id="meeting-edit-owner" disabled style="opacity: 0.7;" />
              </div>
            </div>
          </div>
          
          <!-- Participants Tab -->
          <div id="meeting-tab-participants" class="meeting-tab-content hidden">
            <div class="user-search-container" id="participant-search-container">
              <input type="text" class="user-search-input" id="participant-search" placeholder="Search users to add..." autocomplete="off" />
              <span class="material-icons user-search-icon">search</span>
              <div class="user-search-dropdown hidden" id="participant-search-dropdown"></div>
            </div>
            
            <div class="participant-list" id="participant-list">
              <!-- Participants loaded dynamically -->
            </div>
          </div>
        </div>
        
        <div class="meeting-modal-footer">
          <button class="modal-btn modal-btn-danger" id="meeting-delete-btn" onclick="confirmDeleteMeeting()">
            <span class="material-icons" style="font-size: 16px; vertical-align: middle; margin-right: 4px;">delete</span>
            Delete
          </button>
          <div style="display: flex; gap: 12px;">
            <button class="modal-btn modal-btn-secondary" onclick="closeMeetingModal()">Cancel</button>
            <button class="modal-btn modal-btn-primary" id="meeting-save-btn" onclick="saveMeetingChanges()">Save Changes</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Delete Confirmation Dialog -->
    <div id="confirm-delete-dialog" class="confirm-dialog hidden">
      <div class="confirm-dialog-content">
        <div class="confirm-dialog-icon">
          <span class="material-icons">warning</span>
        </div>
        <h3>Delete Meeting?</h3>
        <p>This action cannot be undone. All participants will be removed.</p>
        <div class="confirm-dialog-buttons">
          <button class="modal-btn modal-btn-secondary" onclick="cancelDelete()">Cancel</button>
          <button class="modal-btn modal-btn-danger" onclick="executeDeleteMeeting()">Delete</button>
        </div>
      </div>
    </div>

    <!-- Create Meeting Modal -->
    <div id="create-meeting-modal" class="hidden" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.8); display: flex; align-items: center; justify-content: center; z-index: 2000; backdrop-filter: blur(5px);">
      <div class="meeting-modal-content" style="max-width: 480px;">
        <div class="meeting-modal-header" style="border-radius: 16px 16px 0 0;">
          <div style="display: flex; align-items: center; gap: 12px;">
            <div style="width: 40px; height: 40px; border-radius: 10px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center;">
              <span class="material-icons" style="font-size: 20px; color: white;">add_circle</span>
            </div>
            <div>
              <h2 style="margin: 0; font-size: 1.1rem;">Create New Meeting</h2>
              <p style="margin: 0; font-size: 12px; color: #9aa0a6;">Schedule a meeting with participants</p>
            </div>
          </div>
          <button class="meeting-modal-close" onclick="closeCreateMeetingModal()">&times;</button>
        </div>
        
        <div class="meeting-modal-body">
          <div class="meeting-info-row">
            <span class="meeting-info-label">Name *</span>
            <div class="meeting-info-value">
              <input type="text" id="create-meeting-name" placeholder="e.g., Weekly Standup" maxlength="100" />
            </div>
          </div>
          <div class="meeting-info-row">
            <span class="meeting-info-label">Description</span>
            <div class="meeting-info-value">
              <textarea id="create-meeting-description" placeholder="What's this meeting about? (optional)" maxlength="1024"></textarea>
            </div>
          </div>
          <div class="meeting-info-row">
            <span class="meeting-info-label">Date & Time *</span>
            <div class="meeting-info-value">
              <input type="datetime-local" id="create-meeting-datetime" />
            </div>
          </div>
          
          <!-- Quick time suggestions -->
          <div style="display: flex; gap: 8px; flex-wrap: wrap; margin-top: 4px;">
            <button onclick="setQuickTime('now')" class="quick-time-btn" style="padding: 6px 12px; font-size: 11px; border-radius: 16px; border: 1px solid rgba(255,255,255,0.15); background: rgba(255,255,255,0.05); color: #9aa0a6; cursor: pointer; transition: all 0.2s;">Start Now</button>
            <button onclick="setQuickTime('30min')" class="quick-time-btn" style="padding: 6px 12px; font-size: 11px; border-radius: 16px; border: 1px solid rgba(255,255,255,0.15); background: rgba(255,255,255,0.05); color: #9aa0a6; cursor: pointer; transition: all 0.2s;">In 30 min</button>
            <button onclick="setQuickTime('1hour')" class="quick-time-btn" style="padding: 6px 12px; font-size: 11px; border-radius: 16px; border: 1px solid rgba(255,255,255,0.15); background: rgba(255,255,255,0.05); color: #9aa0a6; cursor: pointer; transition: all 0.2s;">In 1 hour</button>
            <button onclick="setQuickTime('tomorrow')" class="quick-time-btn" style="padding: 6px 12px; font-size: 11px; border-radius: 16px; border: 1px solid rgba(255,255,255,0.15); background: rgba(255,255,255,0.05); color: #9aa0a6; cursor: pointer; transition: all 0.2s;">Tomorrow</button>
          </div>
        </div>
        
        <div class="meeting-modal-footer" style="border-radius: 0 0 16px 16px;">
          <div></div>
          <div style="display: flex; gap: 12px;">
            <button class="modal-btn modal-btn-secondary" onclick="closeCreateMeetingModal()">Cancel</button>
            <button class="modal-btn modal-btn-primary" id="create-meeting-submit-btn" onclick="submitCreateMeeting()">
              <span class="material-icons" style="font-size: 16px; vertical-align: middle; margin-right: 4px;">event_available</span>
              Create Meeting
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Room Section -->
    <div id="room-section" class="hidden">
      <!-- Mobile Header (visible only on mobile) -->
      <div id="mobile-header">
        <div class="room-info-mobile">
          <span id="current-room-id-mobile"></span>
          <span style="color: #9aa0a6">|</span>
          <span id="my-role-mobile" style="color: #9aa0a6"></span>
        </div>
      </div>

      <div id="main-area">
        <div class="sharing-indicator hidden" id="sharing-badge">
          <span class="material-icons">screen_share</span>
          <span>You are presenting</span>
        </div>

        <!-- Join Requests Toast Area -->
        <div
          id="join-requests-area"
          style="
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 100;
            display: flex;
            flex-direction: column;
            gap: 10px;
          "
        ></div>

        <div id="video-grid">
          <!-- Videos go here -->
          <div id="video-container" style="display: contents"></div>
        </div>

        <!-- Sidebar -->
        <div id="sidebar">
          <div class="sidebar-header">
            <h3>People</h3>
            <div
              id="admin-controls"
              class="hidden"
              style="display: flex; align-items: center; gap: 8px"
            >
              <label
                style="font-size: 12px; cursor: pointer; user-select: none"
              >
                <input
                  type="checkbox"
                  id="auto-approve-toggle"
                  style="width: auto; transform: scale(1.2)"
                />
                Auto-Admit
              </label>
            </div>
            <button
              class="control-btn"
              style="
                width: 32px;
                height: 32px;
                background: none;
                color: #5f6368;
                margin-left: auto;
              "
              onclick="toggleSidebar()"
            >
              <span class="material-icons">close</span>
            </button>
          </div>
          
          <!-- Sidebar Tabs -->
          <div class="sidebar-tabs">
            <button class="sidebar-tab active" data-tab="people" onclick="switchSidebarTab('people')">
              <span class="material-icons">people</span> People
            </button>
            <button class="sidebar-tab" data-tab="chat" onclick="switchSidebarTab('chat')">
              <span class="material-icons">chat</span> Chat
              <span id="chat-unread-badge" class="unread-badge hidden">0</span>
            </button>
          </div>
          
          <!-- People Tab Content -->
          <div id="sidebar-people" class="sidebar-tab-content">
            <div id="participants-container"></div>
          </div>
          
          <!-- Chat Tab Content -->
          <div id="sidebar-chat" class="sidebar-tab-content hidden">
            <div id="chat-messages"></div>
            <div id="chat-input-container">
              <input type="text" id="chat-input" placeholder="Send a message..." autocomplete="off" />
              <button id="chat-send-btn" onclick="sendChatMessage()">
                <span class="material-icons">send</span>
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Subtitles (legacy, hidden) -->
      <div id="subtitles-area" style="display:none"><div id="subtitles-inner"></div></div>

      <!-- Host Speaking Indicator -->
      <div id="host-speaking-indicator" class="hidden">
        <div class="signal-light idle"></div>
        <span class="signal-label">Listening</span>
      </div>

      <!-- Host Feedback Panel (only visible to host when clients are translating) -->
      <div id="host-feedback-panel" class="hidden">
        <div class="feedback-header">
          <span class="material-icons">hearing</span>
          <span>Live Translations</span>
        </div>
        <div id="active-translations"></div>
      </div>

      <!-- Client Audio Playing Indicator -->
      <div id="client-audio-indicator" class="hidden">
        <div class="audio-wave"><span></span></div>
        <span>Playing translated audio...</span>
      </div>

      <!-- Scrollable Transcript Container -->
      <div id="transcript-container">
        <div id="transcript-header">
          <span>Live Transcript</span>
          <button onclick="toggleTranscript()" style="background:none;border:none;color:#9aa0a6;cursor:pointer;font-size:18px;">&times;</button>
        </div>
        <div id="transcript-entries"></div>
      </div>

      <!-- Footer Controls -->
      <div id="controls-footer">
        <div
          class="room-info-desktop"
          style="
            flex: 1;
            display: flex;
            align-items: center;
            gap: 10px;
            color: #e8eaed;
          "
        >
          <span
            id="current-room-id"
            style="font-weight: 500; margin-left: 20px"
          ></span>
          <span style="color: #9aa0a6">|</span>
          <span id="my-role" style="font-size: 0.9em; color: #9aa0a6"></span>
        </div>

        <button id="mic-btn" class="control-btn" title="Microphone">
          <span class="material-icons">mic_off</span>
        </button>

        <button id="camera-btn" class="control-btn" title="Camera">
          <span class="material-icons">videocam_off</span>
        </button>

        <!-- Recording Button -->
        <button id="record-btn" class="control-btn" title="Record meeting" onclick="toggleRecording()">
          <span class="material-icons">fiber_manual_record</span>
        </button>

        <!-- Hidden by default, shown for admin -->
        <button id="share-btn" class="control-btn hidden" title="Present now">
          <span class="material-icons">present_to_all</span>
        </button>

        <button
          id="people-btn"
          class="control-btn"
          title="People"
          onclick="toggleSidebar()"
        >
          <span class="material-icons">people</span>
          <span id="people-unread-dot" class="unread-dot hidden"></span>
        </button>

        <!-- Transcript Toggle Button -->
        <button
          id="transcript-btn"
          class="control-btn"
          title="Toggle Transcript"
          onclick="toggleTranscript()"
        >
          <span class="material-icons">closed_caption</span>
        </button>

        <!-- Audio Mode Toggle Button -->
        <button
          id="audio-mode-btn"
          class="control-btn"
          title="Toggle: Original voice / Translated only"
          onclick="toggleAudioMode()"
        >
          <span class="material-icons">translate</span>
        </button>

        <button
          class="control-btn danger"
          style="width: 60px; border-radius: 30px"
          onclick="location.reload()"
        >
          <span class="material-icons">call_end</span>
        </button>

        <div style="flex: 1"></div>
      </div>

      <!-- Recording Indicator -->
      <div id="recording-indicator" class="hidden">
        <span class="recording-dot"></span>
        <span id="recording-time">REC 00:00</span>
      </div>
    </div>

    <!-- Download Recording Modal -->
    <div id="download-recording-modal" class="hidden">
      <div class="download-modal-content">
        <div class="download-modal-icon">
          <span class="material-icons">videocam</span>
        </div>
        <h3>Recording Ready!</h3>
        <p id="recording-info">Your meeting recording is ready to download.</p>
        <div class="download-modal-buttons">
          <button class="btn-dismiss" onclick="dismissDownloadModal()">Dismiss</button>
          <button class="btn-download" id="download-recording-btn">
            <span class="material-icons" style="font-size: 18px; vertical-align: middle; margin-right: 4px;">download</span>
            Download
          </button>
        </div>
      </div>
    </div>

    <script>
      function toggleSidebar() {
        const sb = document.getElementById("sidebar");
        sb.classList.toggle("open");
      }

      // ============================================
      // Auth Tab Switching
      // ============================================
      function switchTab(tabName) {
        // Update tab buttons
        document.querySelectorAll('.auth-tab').forEach(tab => {
          tab.classList.toggle('active', tab.dataset.tab === tabName);
        });
        
        // Update tab content
        document.querySelectorAll('.tab-content').forEach(content => {
          content.classList.add('hidden');
        });
        const tabContent = document.getElementById(`tab-${tabName}`);
        if (tabContent) tabContent.classList.remove('hidden');
        
        // Clear error message
        hideAuthMessage();
      }

      // Tab click handlers
      document.addEventListener('DOMContentLoaded', () => {
        document.querySelectorAll('.auth-tab').forEach(tab => {
          tab.addEventListener('click', () => switchTab(tab.dataset.tab));
        });

        // Check session on load
        checkAuthSession();
      });

      // ============================================
      // Auth Message Display
      // ============================================
      function showAuthMessage(message, isError = true) {
        const el = document.getElementById('auth-message');
        el.textContent = message;
        el.className = isError ? 'auth-message-error' : 'auth-message-success';
        el.classList.remove('hidden');
      }

      function hideAuthMessage() {
        const el = document.getElementById('auth-message');
        el.classList.add('hidden');
        el.className = 'hidden';
      }

      // ============================================
      // Auth State Management
      // ============================================
      async function checkAuthSession() {
        if (window.ApiService && window.ApiService.isAuthenticated()) {
          const isValid = await window.ApiService.validateSession();
          if (isValid) {
            updateUIForAuthenticatedUser();
            loadUserMeetings();
          }
        }
      }

      function updateUIForAuthenticatedUser() {
        const user = window.ApiService.user;
        if (!user) return;

        // Show user info header
        document.getElementById('user-info-header').classList.remove('hidden');
        document.getElementById('user-avatar').textContent = (user.fullname || user.username || 'U').charAt(0).toUpperCase();
        document.getElementById('user-fullname').textContent = user.fullname || user.username;
        document.getElementById('user-username').textContent = '@' + user.username;

        // Set username for joining (readonly, from profile)
        const usernameInput = document.getElementById('username');
        if (usernameInput) {
          usernameInput.value = user.fullname || user.username;
        }

        // Show Join tab, hide login/register tabs for authenticated users
        const joinTab = document.getElementById('join-tab-btn');
        if (joinTab) joinTab.style.display = '';
        
        const authTabs = document.querySelector('.auth-tabs');
        if (authTabs) {
          authTabs.querySelectorAll('[data-tab="login"], [data-tab="register"]').forEach(tab => {
            tab.style.display = 'none';
          });
        }
        
        // Switch to Join tab
        switchTab('join');
      }

      function updateUIForUnauthenticatedUser() {
        // Hide user info
        document.getElementById('user-info-header').classList.add('hidden');
        // document.getElementById('my-meetings-section').classList.add('hidden');

        // Clear username
        const usernameInput = document.getElementById('username');
        if (usernameInput) usernameInput.value = '';

        // Hide Join tab, show login/register tabs
        const joinTab = document.getElementById('join-tab-btn');
        if (joinTab) joinTab.style.display = 'none';
        
        const authTabs = document.querySelector('.auth-tabs');
        if (authTabs) {
          authTabs.querySelectorAll('[data-tab="login"], [data-tab="register"]').forEach(tab => {
            tab.style.display = '';
          });
        }

        // Switch to login tab
        switchTab('login');
      }

      // ============================================
      // Login Handler
      // ============================================
      document.addEventListener('DOMContentLoaded', () => {
        const loginBtn = document.getElementById('login-btn');
        if (loginBtn) {
          loginBtn.addEventListener('click', async () => {
            const username = document.getElementById('login-username').value.trim();
            const password = document.getElementById('login-password').value;

            if (!username || !password) {
              showAuthMessage('Please enter username and password');
              return;
            }

            loginBtn.disabled = true;
            loginBtn.textContent = 'Signing in...';

            try {
              await window.ApiService.login(username, password);
              showAuthMessage('Login successful!', false);
              updateUIForAuthenticatedUser();
              loadUserMeetings();
              
              // Switch to join tab after brief delay
              setTimeout(() => {
                switchTab('join');
                hideAuthMessage();
              }, 1000);
            } catch (error) {
              showAuthMessage(error.message || 'Login failed. Please check your credentials.');
            } finally {
              loginBtn.disabled = false;
              loginBtn.textContent = 'Sign In';
            }
          });
        }
      });

      // ============================================
      // Registration Handler
      // ============================================
      document.addEventListener('DOMContentLoaded', () => {
        const registerBtn = document.getElementById('register-btn');
        if (registerBtn) {
          registerBtn.addEventListener('click', async () => {
            const firstName = document.getElementById('reg-firstname').value.trim();
            const lastName = document.getElementById('reg-lastname').value.trim();
            const username = document.getElementById('reg-username').value.trim();
            const email = document.getElementById('reg-email').value.trim();
            const password = document.getElementById('reg-password').value;
            const confirmPassword = document.getElementById('reg-confirm-password').value;

            // Validation
            if (!firstName || !lastName || !username || !email || !password) {
              showAuthMessage('Please fill in all fields');
              return;
            }

            if (password !== confirmPassword) {
              showAuthMessage('Passwords do not match');
              return;
            }

            if (password.length < 6) {
              showAuthMessage('Password must be at least 6 characters');
              return;
            }

            registerBtn.disabled = true;
            registerBtn.textContent = 'Creating account...';

            try {
              await window.ApiService.register({
                first_name: firstName,
                last_name: lastName,
                username: username,
                email: email,
                password: password,
                confirm_password: confirmPassword
              });

              showAuthMessage('Account created! Signing you in...', false);

              // Auto-login after registration
              await window.ApiService.login(username, password);
              updateUIForAuthenticatedUser();
              loadUserMeetings();
              
              setTimeout(() => {
                switchTab('join');
                hideAuthMessage();
              }, 1000);
            } catch (error) {
              const msg = error.data 
                ? Object.values(error.data).flat().join(', ')
                : error.message || 'Registration failed';
              showAuthMessage(msg);
            } finally {
              registerBtn.disabled = false;
              registerBtn.textContent = 'Create Account';
            }
          });
        }
      });

      // ============================================
      // Logout Handler
      // ============================================
      document.addEventListener('DOMContentLoaded', () => {
        const logoutBtn = document.getElementById('logout-btn');
        if (logoutBtn) {
          logoutBtn.addEventListener('click', () => {
            window.ApiService.logout();
            updateUIForUnauthenticatedUser();
          });
        }
      });

      // ============================================
      // Settings Modal
      // ============================================
      let selectedAvatarFile = null;

      function toggleSettingsModal() {
        const modal = document.getElementById('settings-modal');
        if (modal.classList.contains('hidden')) {
          modal.classList.remove('hidden');
          modal.style.display = 'flex';
          
          // Populate profile fields when opening
          populateProfileForm();
        } else {
          modal.classList.add('hidden');
          modal.style.display = 'none';
          selectedAvatarFile = null;
        }
      }

      function populateProfileForm() {
        const user = window.ApiService?.user;
        if (!user) return;

        console.log('User data:', user); // Debug to see actual field names

        // Avatar
        const avatarImg = document.getElementById('settings-avatar-img');
        const avatarLetter = document.getElementById('settings-avatar-letter');
        
        if (user.thumbnail || user.avatar) {
          avatarImg.src = user.thumbnail || user.avatar;
          avatarImg.style.display = 'block';
          avatarLetter.style.display = 'none';
        } else {
          avatarImg.style.display = 'none';
          avatarLetter.style.display = 'block';
          avatarLetter.textContent = (user.fullname || user.username || 'U').charAt(0).toUpperCase();
        }

        // Get first/last name - check multiple possible field names
        let firstName = user.first_name || user.firstName || '';
        let lastName = user.last_name || user.lastName || '';
        
        // If first/last name are empty but fullname exists, try to split it
        if ((!firstName || !lastName) && user.fullname) {
          const nameParts = user.fullname.trim().split(/\s+/);
          if (nameParts.length >= 2) {
            firstName = firstName || nameParts[0];
            lastName = lastName || nameParts.slice(1).join(' ');
          } else if (nameParts.length === 1) {
            firstName = firstName || nameParts[0];
          }
        }

        // Fields
        document.getElementById('settings-firstname').value = firstName;
        document.getElementById('settings-lastname').value = lastName;
        document.getElementById('settings-username').value = user.username || '';
      }

      function handleAvatarSelect(input) {
        if (input.files && input.files[0]) {
          const file = input.files[0];
          
          // Validate size (2MB)
          if (file.size > 2 * 1024 * 1024) {
            showSettingsMessage('Image size must be less than 2MB');
            return;
          }

          selectedAvatarFile = file;

          // Preview
          const reader = new FileReader();
          reader.onload = (e) => {
            const avatarImg = document.getElementById('settings-avatar-img');
            const avatarLetter = document.getElementById('settings-avatar-letter');
            avatarImg.src = e.target.result;
            avatarImg.style.display = 'block';
            avatarLetter.style.display = 'none';
          };
          reader.readAsDataURL(file);
        }
      }

      // Save Profile Handler
      document.addEventListener('DOMContentLoaded', () => {
        const saveBtn = document.getElementById('save-profile-btn');
        if (saveBtn) {
          saveBtn.addEventListener('click', async () => {
            const user = window.ApiService?.user;
            if (!user) return;

            const firstName = document.getElementById('settings-firstname').value.trim();
            const lastName = document.getElementById('settings-lastname').value.trim();
            const newUsername = document.getElementById('settings-username').value.trim();

            if (!firstName || !lastName || !newUsername) {
              showSettingsMessage('Please fill in all fields');
              return;
            }

            saveBtn.disabled = true;
            saveBtn.textContent = 'Saving...';

            try {
              const currentUsername = user.username;

              // If avatar is selected, use FormData
              if (selectedAvatarFile) {
                const formData = new FormData();
                formData.append('avatar', selectedAvatarFile);
                formData.append('first_name', firstName);
                formData.append('last_name', lastName);
                if (newUsername !== currentUsername) {
                  formData.append('username', newUsername);
                }
                
                await window.ApiService.updateUserWithAvatar(currentUsername, formData);
              } else {
                // Just update fields without avatar
                const updateData = {
                  first_name: firstName,
                  last_name: lastName
                };
                if (newUsername !== currentUsername) {
                  updateData.username = newUsername;
                }
                
                await window.ApiService.updateUser(currentUsername, updateData);
              }

              showSettingsMessage('Profile updated successfully!', false);
              selectedAvatarFile = null;

              // Update UI
              updateUIForAuthenticatedUser();
              
            } catch (error) {
              const msg = error.data 
                ? Object.values(error.data).flat().join(', ')
                : error.message || 'Failed to update profile';
              showSettingsMessage(msg);
            } finally {
              saveBtn.disabled = false;
              saveBtn.textContent = 'Save Profile';
            }
          });
        }
      });

      // Settings tab switching
      document.addEventListener('DOMContentLoaded', () => {
        document.querySelectorAll('.settings-tab').forEach(tab => {
          tab.addEventListener('click', () => {
            const tabName = tab.dataset.settingsTab;
            
            // Update tab buttons
            document.querySelectorAll('.settings-tab').forEach(t => {
              t.classList.toggle('active', t.dataset.settingsTab === tabName);
              t.style.background = t.dataset.settingsTab === tabName ? 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' : 'transparent';
              t.style.color = t.dataset.settingsTab === tabName ? 'white' : '#9aa0a6';
            });
            
            // Update content
            document.querySelectorAll('.settings-content').forEach(c => c.classList.add('hidden'));
            document.getElementById(`settings-${tabName}`).classList.remove('hidden');
            
            // Clear message
            document.getElementById('settings-message').classList.add('hidden');
          });
        });
      });

      function showSettingsMessage(msg, isError = true) {
        const el = document.getElementById('settings-message');
        el.textContent = msg;
        el.className = isError ? 'auth-message-error' : 'auth-message-success';
        el.classList.remove('hidden');
      }

      // Change Password Handler
      document.addEventListener('DOMContentLoaded', () => {
        const btn = document.getElementById('change-password-btn');
        if (btn) {
          btn.addEventListener('click', async () => {
            const currentPassword = document.getElementById('settings-current-password').value;
            const newPassword = document.getElementById('settings-new-password').value;
            const confirmPassword = document.getElementById('settings-confirm-password').value;

            if (!currentPassword || !newPassword || !confirmPassword) {
              showSettingsMessage('Please fill in all fields');
              return;
            }

            if (newPassword !== confirmPassword) {
              showSettingsMessage('New passwords do not match');
              return;
            }

            btn.disabled = true;
            btn.textContent = 'Changing...';

            try {
              await window.ApiService.changePassword({
                current_password: currentPassword,
                new_password: newPassword,
                confirm_new_password: confirmPassword
              });
              showSettingsMessage('Password changed successfully!', false);
              
              // Clear fields
              document.getElementById('settings-current-password').value = '';
              document.getElementById('settings-new-password').value = '';
              document.getElementById('settings-confirm-password').value = '';
            } catch (error) {
              showSettingsMessage(error.message || 'Failed to change password');
            } finally {
              btn.disabled = false;
              btn.textContent = 'Change Password';
            }
          });
        }
      });

      // Change Email Handler
      document.addEventListener('DOMContentLoaded', () => {
        const btn = document.getElementById('change-email-btn');
        if (btn) {
          btn.addEventListener('click', async () => {
            const currentPassword = document.getElementById('settings-email-password').value;
            const newEmail = document.getElementById('settings-new-email').value;

            if (!currentPassword || !newEmail) {
              showSettingsMessage('Please fill in all fields');
              return;
            }

            btn.disabled = true;
            btn.textContent = 'Changing...';

            try {
              await window.ApiService.changeEmail({
                current_password: currentPassword,
                email: newEmail
              });
              showSettingsMessage('Email changed successfully!', false);
              
              // Clear fields
              document.getElementById('settings-email-password').value = '';
              document.getElementById('settings-new-email').value = '';
            } catch (error) {
              showSettingsMessage(error.message || 'Failed to change email');
            } finally {
              btn.disabled = false;
              btn.textContent = 'Change Email';
            }
          });
        }
      });

      function switchAccountTab(tabName) {
        // Update tabs - only meetings and invitations now
        ['meetings', 'invitations'].forEach(t => {
            const btn = document.getElementById(`tab-${t}`);
            const content = document.getElementById(`content-${t}`);
            
            if (t === tabName) {
                btn.classList.add('active');
                btn.style.color = '#fff';
                btn.style.borderBottomColor = '#8ab4f8';
                btn.style.background = 'rgba(255,255,255,0.05)';
                content.classList.remove('hidden');
            } else {
                btn.classList.remove('active');
                btn.style.color = '#9aa0a6';
                btn.style.borderBottomColor = 'transparent';
                btn.style.background = 'transparent';
                content.classList.add('hidden');
            }
        });
      }

      function openAccountModal() {
        if (!window.ApiService.isAuthenticated()) return;
        
        const modal = document.getElementById('account-modal');
        modal.classList.remove('hidden');
        
        // Default to meetings
        switchAccountTab('meetings');
        loadUserMeetings();
        loadInvitations();
      }

      function closeAccountModal() {
        document.getElementById('account-modal').classList.add('hidden');
      }

      // ============================================
      // Meetings Management
      // ============================================
      let currentMeeting = null;
      let currentParticipants = [];
      let searchTimeout = null;

      async function loadUserMeetings() {
        if (!window.ApiService.isAuthenticated()) return;

        const listEl = document.getElementById('meetings-list');
        const emptyEl = document.getElementById('meetings-empty-state');
        
        if (!listEl) return;
        
        listEl.innerHTML = '<div style="text-align: center; padding: 24px; color: #9aa0a6; font-size: 13px;">Loading...</div>';

        try {
          // 1. Get meetings I own
          const ownedResponse = await window.ApiService.getMeetings({ limit: 20 });
          const ownedMeetings = Array.isArray(ownedResponse) ? ownedResponse : (ownedResponse.results || []);
          
          // 2. Get meetings I'm accepted in (using getMyParticipations)
          const acceptedResponse = await window.ApiService.getMyParticipations({ accepted: true });
          const acceptedParticipations = Array.isArray(acceptedResponse) ? acceptedResponse : (acceptedResponse.results || []);
          
          // Merge: Map participations to meeting objects, filter out duplicates if I own them (unlikely but safe)
          const currentUserId = window.ApiService.user?.id;
          
          const acceptedMeetings = acceptedParticipations
            .map(p => p.meet)
            .filter(m => m.owner.id !== currentUserId); // Avoid showing owned meetings twice if logic overlaps
            
          const allUpcoming = [...ownedMeetings, ...acceptedMeetings];
          
          // Sort by date desc (or asc for upcoming)
          allUpcoming.sort((a, b) => new Date(b.start_at) - new Date(a.start_at));

          if (allUpcoming.length === 0) {
            listEl.innerHTML = '';
            emptyEl.classList.remove('hidden');
            return;
          }

          emptyEl.classList.add('hidden');
          listEl.innerHTML = '';
          
          allUpcoming.forEach(meeting => {
            const item = document.createElement('div');
            item.style.cssText = 'background: rgba(255,255,255,0.05); padding: 14px 16px; border-radius: 10px; cursor: pointer; transition: background 0.2s; border: 1px solid rgba(255,255,255,0.08);';
            item.onmouseover = () => item.style.background = 'rgba(255,255,255,0.08)';
            item.onmouseout = () => item.style.background = 'rgba(255,255,255,0.05)';
            
            const date = new Date(meeting.start_at);
            const dateStr = date.toLocaleDateString(undefined, { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' });
            
            const isOwner = meeting.owner?.id === currentUserId;
            
            // Time check
            const now = new Date();
            const timeDiff = date - now;
            let statusText = '';
            let statusColor = '';
            
            if (timeDiff < 0) {
              statusText = 'Past';
              statusColor = 'color: #9aa0a6; background: rgba(255,255,255,0.1);';
            } else if (timeDiff < 3600000) {
              statusText = 'Starting Soon';
              statusColor = 'color: #81c995; background: rgba(52, 168, 83, 0.2);';
            } else {
              statusText = 'Upcoming';
              statusColor = 'color: #8ab4f8; background: rgba(138, 180, 248, 0.2);';
            }
            
            item.innerHTML = `
              <div style="display: flex; align-items: center; justify-content: space-between; gap: 12px;">
                <div style="flex: 1; min-width: 0;">
                  <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">
                    <h4 style="margin: 0; font-size: 15px; font-weight: 600; color: #fff; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${meeting.name}</h4>
                    <span style="font-size: 10px; padding: 2px 8px; border-radius: 4px; ${statusColor}">${statusText}</span>
                  </div>
                  <div style="display: flex; align-items: center; gap: 12px; font-size: 12px; color: #9aa0a6;">
                    <span style="display: flex; align-items: center; gap: 4px;">
                      <span class="material-icons" style="font-size: 14px;">event</span>
                      ${dateStr}
                    </span>
                    <span style="display: flex; align-items: center; gap: 4px;">
                      <span class="material-icons" style="font-size: 14px;">person</span>
                      By ${isOwner ? 'You' : (meeting.owner?.fullname || meeting.owner?.username)}
                    </span>
                  </div>
                </div>
                
                <div style="display: flex; align-items: center; gap: 8px;">
                  <button onclick="event.stopPropagation(); joinMeetingFromList('${meeting.name}')" style="padding: 8px 12px; border-radius: 8px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; cursor: pointer; display: flex; align-items: center; gap: 4px; font-size: 12px; font-weight: 500;">
                    <span class="material-icons" style="font-size: 16px;">videocam</span>
                    Join
                  </button>
                  ${isOwner ? `
                  <button onclick="event.stopPropagation(); openMeetingModal('${meeting.slug}')" style="padding: 8px; border-radius: 8px; background: rgba(255,255,255,0.1); color: #9aa0a6; border: none; cursor: pointer;" title="Manage">
                    <span class="material-icons" style="font-size: 16px;">settings</span>
                  </button>` : ''}
                </div>
              </div>
            `;
            
            // Make whole card clickable to join logic or details
            item.onclick = () => joinMeetingFromList(meeting);
            listEl.appendChild(item);
          });
          
        } catch (error) {
          console.error("Error loading meetings", error);
          listEl.innerHTML = '<div class="text-center py-4 text-red-400 text-sm">Failed to load meetings</div>';
        }
      }

      async function loadInvitations() {
        if (!window.ApiService.isAuthenticated()) return;
        
        const listEl = document.getElementById('invitations-list');
        const emptyEl = document.getElementById('invitations-empty-state');
        const badgeEl = document.getElementById('invitations-badge');
        
        listEl.innerHTML = '<div style="text-align: center; padding: 24px; color: #9aa0a6; font-size: 13px;">Loading invitations...</div>';
        
        try {
            const response = await window.ApiService.getMyParticipations();
            const participations = Array.isArray(response) ? response : (response.results || []);
            
            // Filter where accepted is not true (pending or declined)
            const pendingInvites = participations.filter(p => p.accepted !== true);
            
            if (pendingInvites.length > 0) {
                badgeEl.classList.remove('hidden');
                emptyEl.classList.add('hidden');
                listEl.innerHTML = '';
                
                pendingInvites.forEach(p => {
                    const meeting = p.meet;
                    const date = new Date(meeting.start_at);
                    const dateStr = date.toLocaleDateString(undefined, { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' });
                    
                    const el = document.createElement('div');
                    el.style.cssText = 'background: rgba(255,255,255,0.05); padding: 14px 16px; border-radius: 10px; border-left: 3px solid #f59e0b; border: 1px solid rgba(255,255,255,0.08);';
                    
                    el.innerHTML = `
                      <div style="display: flex; align-items: flex-start; justify-content: space-between; gap: 12px;">
                        <div style="flex: 1;">
                          <h4 style="margin: 0 0 4px; font-size: 15px; font-weight: 600; color: #fff;">${meeting.name}</h4>
                          <p style="margin: 0 0 8px; font-size: 12px; color: #9aa0a6;">Invited by ${meeting.owner?.fullname || meeting.owner?.username}</p>
                          <div style="display: inline-flex; align-items: center; gap: 4px; font-size: 11px; color: #9aa0a6; background: rgba(0,0,0,0.3); padding: 4px 8px; border-radius: 4px;">
                            <span class="material-icons" style="font-size: 12px;">event</span>
                            ${dateStr}
                          </div>
                        </div>
                        <div style="display: flex; flex-direction: column; gap: 6px;">
                          <button onclick="respondToInvitation(${p.id}, true)" style="padding: 6px 12px; border-radius: 6px; background: #34a853; color: white; border: none; cursor: pointer; font-size: 11px; font-weight: 500; display: flex; align-items: center; gap: 4px;">
                            <span class="material-icons" style="font-size: 14px;">check</span> Accept
                          </button>
                          <button onclick="respondToInvitation(${p.id}, false)" style="padding: 6px 12px; border-radius: 6px; background: rgba(234, 67, 53, 0.2); color: #f28b82; border: 1px solid rgba(234, 67, 53, 0.3); cursor: pointer; font-size: 11px; font-weight: 500; display: flex; align-items: center; gap: 4px;">
                            <span class="material-icons" style="font-size: 14px;">close</span> Decline
                          </button>
                        </div>
                      </div>
                    `;
                    listEl.appendChild(el);
                });
            } else {
                badgeEl.classList.add('hidden');
                listEl.innerHTML = '';
                emptyEl.classList.remove('hidden');
            }
            
        } catch (error) {
             console.error("Error loading invitations", error);
             listEl.innerHTML = '<div style="text-align: center; padding: 16px; color: #f28b82; font-size: 13px;">Failed to load invitations</div>';
        }
      }

      async function respondToInvitation(participantId, isAccepted) {
        try {
            await window.ApiService.updateParticipantAcceptance(participantId, isAccepted);
            // Refresh lists
            loadInvitations();
            loadUserMeetings(); 
            // Also refresh upcoming meetings as accepted one should appear there
        } catch (error) {
            alert('Failed to update invitation status');
        }
      }

      function joinMeetingFromList(meetingOrName) {
        const name = typeof meetingOrName === 'string' ? meetingOrName : meetingOrName.name;
        // Logic to populate join form
        // ... assuming you want to switch to join tab
        // Close modal first
        closeAccountModal();
        
        // Populate room ID input (assuming logic matches how slugs/names work)
        // If we have slug, use that as room ID? Or name? Client usually joins by room ID string.
        // Let's us slug if available, else name
        
        let roomId = '';
        if (typeof meetingOrName === 'object' && meetingOrName.slug) {
            roomId = meetingOrName.slug;
        } else {
             roomId = name.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/^-|-$/g, '');
        }
        
        document.getElementById('room-id').value = roomId;
        
        // Scroll to top/hero where join form is? 
        // Or specific 'app' section.
        // Usually we might just want to focus the input.
        window.scrollTo({ top: 0, behavior: 'smooth' });
      }

      // ============================================
      // Meeting Modal Management
      // ============================================
      async function openMeetingModal(slug) {
        currentMeeting = null;
        currentParticipants = [];
        
        const modal = document.getElementById('meeting-modal');
        modal.classList.remove('hidden');
        
        // Reset tabs
        switchMeetingModalTab('details');
        
        try {
          // Load meeting details
          currentMeeting = await window.ApiService.getMeeting(slug);
          
          // Populate form
          document.getElementById('meeting-edit-name').value = currentMeeting.name || '';
          document.getElementById('meeting-edit-description').value = currentMeeting.description || '';
          document.getElementById('meeting-edit-owner').value = currentMeeting.owner?.fullname || currentMeeting.owner?.username || 'Unknown';
          
          // Format datetime for input
          if (currentMeeting.start_at) {
            const dt = new Date(currentMeeting.start_at);
            const localIso = new Date(dt.getTime() - dt.getTimezoneOffset() * 60000).toISOString().slice(0, 16);
            document.getElementById('meeting-edit-datetime').value = localIso;
          }
          
          // Load participants
          await loadParticipants(slug);
          
        } catch (error) {
          console.error('Failed to load meeting:', error);
          closeMeetingModal();
          alert('Failed to load meeting details');
        }
      }

      function closeMeetingModal() {
        document.getElementById('meeting-modal').classList.add('hidden');
        currentMeeting = null;
        currentParticipants = [];
        document.getElementById('participant-search').value = '';
        document.getElementById('participant-search-dropdown').classList.add('hidden');
      }

      function switchMeetingModalTab(tabName) {
        document.querySelectorAll('.meeting-modal-tab').forEach(tab => {
          tab.classList.toggle('active', tab.dataset.modalTab === tabName);
        });
        
        document.querySelectorAll('.meeting-tab-content').forEach(content => {
          content.classList.add('hidden');
        });
        document.getElementById(`meeting-tab-${tabName}`).classList.remove('hidden');
      }

      async function saveMeetingChanges() {
        if (!currentMeeting) return;
        
        const saveBtn = document.getElementById('meeting-save-btn');
        saveBtn.disabled = true;
        saveBtn.textContent = 'Saving...';
        
        try {
          const name = document.getElementById('meeting-edit-name').value.trim();
          const description = document.getElementById('meeting-edit-description').value.trim();
          const datetimeValue = document.getElementById('meeting-edit-datetime').value;
          
          if (!name) {
            throw { message: 'Meeting name is required' };
          }
          
          const updateData = {
            name,
            description,
          };
          
          if (datetimeValue) {
            updateData.start_at = new Date(datetimeValue).toISOString();
          }
          
          await window.ApiService.updateMeeting(currentMeeting.slug, updateData);
          
          closeMeetingModal();
          loadUserMeetings();
          
        } catch (error) {
          alert(error.message || 'Failed to save changes');
        } finally {
          saveBtn.disabled = false;
          saveBtn.textContent = 'Save Changes';
        }
      }

      // ============================================
      // Participants Management
      // ============================================
      async function loadParticipants(slug) {
        const listEl = document.getElementById('participant-list');
        listEl.innerHTML = '<div style="color: #9aa0a6; font-size: 13px; text-align: center; padding: 20px;">Loading participants...</div>';
        
        try {
          const participants = await window.ApiService.getParticipants(slug);
          currentParticipants = Array.isArray(participants) ? participants : (participants.results || []);
          
          renderParticipants();
        } catch (error) {
          listEl.innerHTML = '<div style="color: #f28b82; font-size: 13px; text-align: center; padding: 20px;">Failed to load participants</div>';
        }
      }

      function renderParticipants() {
        const listEl = document.getElementById('participant-list');
        
        // Add owner first
        let html = '';
        if (currentMeeting?.owner) {
          const owner = currentMeeting.owner;
          const initial = (owner.fullname || owner.username || 'U').charAt(0).toUpperCase();
          const avatarContent = owner.thumbnail 
            ? `<img src="${owner.thumbnail}" alt="${owner.fullname || owner.username}" />`
            : initial;
          
          html += `
            <div class="participant-item">
              <div class="participant-avatar">${avatarContent}</div>
              <div class="participant-info">
                <div class="participant-name">${owner.fullname || owner.username}</div>
                <div class="participant-username">@${owner.username}</div>
              </div>
              <span class="status-badge status-owner">Owner</span>
            </div>
          `;
        }
        
        // Add participants
        if (currentParticipants.length === 0) {
          html += '<div style="color: #9aa0a6; font-size: 13px; text-align: center; padding: 16px;">No participants yet</div>';
        } else {
          currentParticipants.forEach(p => {
            const user = p.user_detail || p.user || {};
            const initial = (user.fullname || user.username || 'U').charAt(0).toUpperCase();
            const avatarContent = user.thumbnail 
              ? `<img src="${user.thumbnail}" alt="${user.fullname || user.username}" />`
              : initial;
            
            // Determine status
            let statusClass = 'status-pending';
            let statusText = 'Pending ';
            if (p.accepted === true) {
              statusClass = 'status-accepted';
              statusText = 'Accepted ';
            } else if (p.accepted === false) {
              statusClass = 'status-declined';
              statusText = 'Declined ';
            }
            
            html += `
              <div class="participant-item" data-participant-id="${p.id}">
                <div class="participant-avatar">${avatarContent}</div>
                <div class="participant-info">
                  <div class="participant-name">${user.fullname || user.username}</div>
                  <div class="participant-username">@${user.username}</div>
                </div>
                <span class="status-badge ${statusClass}">${statusText}</span>
                <button class="participant-remove" onclick="removeParticipant(${p.id})" title="Remove participant">
                  <span class="material-icons" style="font-size: 18px;">close</span>
                </button>
              </div>
            `;
          });
        }
        
        listEl.innerHTML = html;
      }

      async function removeParticipant(participantId) {
        if (!confirm('Remove this participant?')) return;
        
        try {
          await window.ApiService.removeParticipant(participantId);
          currentParticipants = currentParticipants.filter(p => p.id !== participantId);
          renderParticipants();
        } catch (error) {
          alert(error.message || 'Failed to remove participant');
        }
      }

      // ============================================
      // User Search for Adding Participants
      // ============================================
      document.addEventListener('DOMContentLoaded', () => {
        const searchInput = document.getElementById('participant-search');
        const dropdown = document.getElementById('participant-search-dropdown');
        
        if (searchInput) {
          searchInput.addEventListener('input', (e) => {
            const query = e.target.value.trim();
            
            if (searchTimeout) clearTimeout(searchTimeout);
            
            if (query.length < 2) {
              dropdown.classList.add('hidden');
              return;
            }
            
            searchTimeout = setTimeout(async () => {
              try {
                const response = await window.ApiService.searchUsers(query);
                const users = response.results || [];
                
                // Filter out owner and existing participants
                const existingIds = new Set([
                  currentMeeting?.owner?.id,
                  ...currentParticipants.map(p => p.user_detail?.id || p.user?.id)
                ].filter(Boolean));
                
                const filteredUsers = users.filter(u => !existingIds.has(u.id));
                
                if (filteredUsers.length === 0) {
                  dropdown.innerHTML = '<div class="user-search-empty">No users found</div>';
                } else {
                  dropdown.innerHTML = filteredUsers.map(u => {
                    const initial = (u.fullname || u.username || 'U').charAt(0).toUpperCase();
                    const avatarContent = u.thumbnail 
                      ? `<img src="${u.thumbnail}" style="width: 32px; height: 32px; border-radius: 50%; object-fit: cover;" />`
                      : `<div style="width: 32px; height: 32px; border-radius: 50%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 12px;">${initial}</div>`;
                    
                    return `
                      <div class="user-search-item" onclick="addParticipant(${u.id}, '${(u.fullname || u.username).replace(/'/g, "\\'")}')">
                        ${avatarContent}
                        <div>
                          <div style="font-weight: 500; color: #fff; font-size: 14px;">${u.fullname || u.username}</div>
                          <div style="font-size: 12px; color: #9aa0a6;">@${u.username}</div>
                        </div>
                      </div>
                    `;
                  }).join('');
                }
                
                dropdown.classList.remove('hidden');
              } catch (error) {
                dropdown.innerHTML = '<div class="user-search-empty">Search failed</div>';
                dropdown.classList.remove('hidden');
              }
            }, 300);
          });
          
          // Close dropdown when clicking outside
          document.addEventListener('click', (e) => {
            if (!e.target.closest('#participant-search-container')) {
              dropdown.classList.add('hidden');
            }
          });
        }
      });

      async function addParticipant(userId, userName) {
        if (!currentMeeting) return;
        
        const dropdown = document.getElementById('participant-search-dropdown');
        const searchInput = document.getElementById('participant-search');
        
        dropdown.classList.add('hidden');
        searchInput.value = '';
        
        try {
          const participant = await window.ApiService.addParticipant(currentMeeting.slug, userId);
          currentParticipants.push(participant);
          renderParticipants();
        } catch (error) {
          alert(error.message || 'Failed to add participant');
        }
      }

      // ============================================
      // Delete Meeting
      // ============================================
      function confirmDeleteMeeting() {
        document.getElementById('confirm-delete-dialog').classList.remove('hidden');
      }

      function cancelDelete() {
        document.getElementById('confirm-delete-dialog').classList.add('hidden');
      }

      async function executeDeleteMeeting() {
        if (!currentMeeting) return;
        
        try {
          await window.ApiService.deleteMeeting(currentMeeting.slug);
          cancelDelete();
          closeMeetingModal();
          loadUserMeetings();
        } catch (error) {
          alert(error.message || 'Failed to delete meeting');
        }
      }

      // ============================================
      // Create Meeting Modal
      // ============================================
      function openCreateMeetingModal() {
        const modal = document.getElementById('create-meeting-modal');
        modal.classList.remove('hidden');
        
        // Clear form
        document.getElementById('create-meeting-name').value = '';
        document.getElementById('create-meeting-description').value = '';
        
        // Set default time to now
        setQuickTime('now');
        
        // Focus the name input
        setTimeout(() => document.getElementById('create-meeting-name').focus(), 100);
      }

      function closeCreateMeetingModal() {
        document.getElementById('create-meeting-modal').classList.add('hidden');
      }

      function setQuickTime(preset) {
        const input = document.getElementById('create-meeting-datetime');
        let date = new Date();
        
        switch(preset) {
          case 'now':
            break;
          case '30min':
            date.setMinutes(date.getMinutes() + 30);
            break;
          case '1hour':
            date.setHours(date.getHours() + 1);
            break;
          case 'tomorrow':
            date.setDate(date.getDate() + 1);
            date.setHours(10, 0, 0, 0); // 10 AM tomorrow
            break;
        }
        
        // Format for datetime-local input
        const localIso = new Date(date.getTime() - date.getTimezoneOffset() * 60000).toISOString().slice(0, 16);
        input.value = localIso;
      }

      async function submitCreateMeeting() {
        const submitBtn = document.getElementById('create-meeting-submit-btn');
        const name = document.getElementById('create-meeting-name').value.trim();
        const description = document.getElementById('create-meeting-description').value.trim();
        const datetimeValue = document.getElementById('create-meeting-datetime').value;
        
        if (!name) {
          alert('Please enter a meeting name');
          return;
        }
        
        if (!datetimeValue) {
          alert('Please select a date and time');
          return;
        }
        
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<span class="material-icons" style="font-size: 16px; vertical-align: middle; margin-right: 4px; animation: spin 1s linear infinite;">sync</span> Creating...';
        
        try {
          const meeting = await window.ApiService.createMeeting({
            name: name,
            description: description,
            start_at: new Date(datetimeValue).toISOString(),
            participants: []
          });
          
          closeCreateMeetingModal();
          loadUserMeetings();
          
          // Open the modal to manage participants
          setTimeout(() => openMeetingModal(meeting.slug), 300);
          
        } catch (error) {
          alert('Failed to create meeting: ' + (error.message || 'Unknown error'));
        } finally {
          submitBtn.disabled = false;
          submitBtn.innerHTML = '<span class="material-icons" style="font-size: 16px; vertical-align: middle; margin-right: 4px;">event_available</span> Create Meeting';
        }
      }

      // ============================================
      // Create Meeting Button Handler
      // ============================================
      document.addEventListener('DOMContentLoaded', () => {
        const createBtn = document.getElementById('create-meeting-btn');
        if (createBtn) {
          createBtn.addEventListener('click', () => {
            openCreateMeetingModal();
          });
        }
      });
    </script>

    <script src="/socket.io/socket.io.js"></script>
    <script src="api.js"></script>
    <script src="mediasoup-client.js"></script>
    <script>
      // ML Translation Service Configuration
      // Defaults to production URL, set window.ML_SERVICE_URL for local dev
      window.ML_SERVICE_URL = 'http://localhost:5001';
    </script>
    <script src="client.js"></script>
  </body>
</html>
